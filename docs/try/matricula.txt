quanto ao formulario de matricula o nome nao pode ser selecionado na hora pprque o aluno esta a ser registrado naquele momento, e essa matricula tambem serve como um cadastro no sistema entao tens que colocar os cmapos da senha e email tambe no formulario, me de a actualizacao do php e do formulario de matricula/ registro no sistema e faca algo do genero: <style>
        .bg-img {
          width: 100%; /* Ou um valor específico, como 500px */
          height: auto; /* Defina a altura conforme necessário */
          background-image: url('../public/img/bg.jpg'); /* Caminho da imagem */
          background-size: cover; /* Faz com que a imagem cubra toda a div */
          background-position: center; /* Centraliza a imagem */
          background-repeat: no-repeat; /* Evita repetições da imagem */
        }

        .table-custom {
            background: rgba(255, 255, 255, 0.2); /* Branco bem transparente */
            backdrop-filter: blur(8px); /* Efeito vidro fosco */
            border-radius: 10px; /* Bordas arredondadas */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda branca fraca */
            color: white; /* Texto branco para contraste */
        }

        .table-custom th,
        .table-custom td {
            padding: 12px;
            color: #ffffff; /* Texto branco */
        }

        .table-custom thead {
            background: rgba(7, 200, 206, 0.55); /* Azul mais transparente */
            color: white;
            font-weight: bold;
        }

        .table-custom tbody tr:hover {
            background: rgba(255, 255, 255, 0.3); /* Efeito ao passar o mouse */
            transition: 0.3s;
        }

        /* Estilo específico para os cards que contêm tabelas */
        .card-table {
            background: rgba(19, 125, 171, 0.082); /* Fundo branco com transparência */
            backdrop-filter: blur(10px); /* Efeito vidro fosco */
            border-radius: 10px; /* Bordas arredondadas */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda sutil */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra leve */
            color: white !important;
        }

        /* Ajuste no cabeçalho do card */
        .card-table .card-header {
            background: rgba(7, 200, 206, 0.836); /* Azul translúcido */
            color: white !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Estilo da tabela dentro do card */
        .card-table .table {
            background: transparent; /* Mantém a tabela transparente dentro do card */
        }
    </style> alem de organizar os botoes de edicao em condicoes use essa pagina como base no que tem de ser adicionado ao que ja esta presente <?php
// require_once "../auth/permissoes.php";
// verificarPermissao(['secretaria']);

require_once 'conexao.php';

// Verificar se já existe diretor geral e pedagógico
$sql = "SELECT id_usuario, nome, tipo FROM usuario WHERE tipo IN ('diretor_geral', 'diretor_pedagogico')";
$result = $conn->query($sql);
$diretoresExistentes = $result->fetch_all(MYSQLI_ASSOC);

$diretorGeralExistente = false;
$diretorPedagogicoExistente = false;

foreach ($diretoresExistentes as $diretor) {
    if ($diretor['tipo'] === 'diretor_geral') {
        $diretorGeralExistente = true;
        $idDiretorGeral = $diretor['id_usuario'];
    } elseif ($diretor['tipo'] === 'diretor_pedagogico') {
        $diretorPedagogicoExistente = true;
        $idDiretorPedagogico = $diretor['id_usuario'];
    }
}

// Query para listar diretores
$query = "SELECT 
             u.id_usuario,
             u.nome, 
             u.email,
             u.bi_numero,
             u.tipo,
             u.status
          FROM usuario u
          WHERE u.tipo IN ('diretor_geral', 'diretor_pedagogico')
          ORDER BY FIELD(u.tipo, 'diretor_geral', 'diretor_pedagogico'), u.nome";

$stmt = $conn->prepare($query);
$stmt->execute();
$result = $stmt->get_result();
$diretores = $result->fetch_all(MYSQLI_ASSOC);
?>

<!DOCTYPE html>
<html lang="pt">
<head>
    <title>SECRETARIA - Gestão de Diretores | Alda Lara</title>
    <!-- HTML5 Shim and Respond.js IE10 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 10]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="#">
    <meta name="keywords" content="Admin , Responsive, Landing, Bootstrap, App, Template, Mobile, iOS, Android, apple, creative app">
    <meta name="author" content="#">
    <!-- Favicon icon -->
    <link rel="icon" href="libraries\assets\images\favicon.ico" type="image/x-icon">
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet">
    <!-- Required Fremwork -->
    <link rel="stylesheet" type="text/css" href="libraries\bower_components\bootstrap\css\bootstrap.min.css">
    <!-- feather Awesome -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\icon\feather\css\feather.css">
    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\style.css">
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\jquery.mCustomScrollbar.css">

    <style>
        .bg-img {
          width: 100%; /* Ou um valor específico, como 500px */
          height: auto; /* Defina a altura conforme necessário */
          background-image: url('../public/img/bg.jpg'); /* Caminho da imagem */
          background-size: cover; /* Faz com que a imagem cubra toda a div */
          background-position: center; /* Centraliza a imagem */
          background-repeat: no-repeat; /* Evita repetições da imagem */
        }

        .table-custom {
            background: rgba(255, 255, 255, 0.2); /* Branco bem transparente */
            backdrop-filter: blur(8px); /* Efeito vidro fosco */
            border-radius: 10px; /* Bordas arredondadas */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda branca fraca */
            color: white; /* Texto branco para contraste */
        }

        .table-custom th,
        .table-custom td {
            padding: 12px;
            color: #ffffff; /* Texto branco */
        }

        .table-custom thead {
            background: rgba(7, 200, 206, 0.55); /* Azul mais transparente */
            color: white;
            font-weight: bold;
        }

        .table-custom tbody tr:hover {
            background: rgba(255, 255, 255, 0.3); /* Efeito ao passar o mouse */
            transition: 0.3s;
        }

        /* Estilo específico para os cards que contêm tabelas */
        .card-table {
            background: rgba(19, 125, 171, 0.082); /* Fundo branco com transparência */
            backdrop-filter: blur(10px); /* Efeito vidro fosco */
            border-radius: 10px; /* Bordas arredondadas */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda sutil */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra leve */
            color: white !important;
        }

        /* Ajuste no cabeçalho do card */
        .card-table .card-header {
            background: rgba(7, 200, 206, 0.836); /* Azul translúcido */
            color: white !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Estilo da tabela dentro do card */
        .card-table .table {
            background: transparent; /* Mantém a tabela transparente dentro do card */
        }
    </style>
    <style>
        /* ... (estilos iguais ao anterior) ... */
        .badge-diretor-geral {
            background-color: #4e73df;
        }
        .badge-diretor-pedagogico {
            background-color: #1cc88a;
        }
    </style>
</head>
<body>
        <!-- Pre-loader -->
        <div class="theme-loader">
        <div class="ball-scale">
            <div class='contain'>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
            </div>
        </div>
    </div>

    <div id="pcoded" class="pcoded">
        <div class="pcoded-overlay-box"></div>
        <div class="pcoded-container navbar-wrapper">
            <nav class="navbar header-navbar pcoded-header">
                <div class="navbar-wrapper">
                    <div class="navbar-logo">
                        <a class="mobile-menu" id="mobile-collapse" href="#!"><i class="feather icon-menu"></i></a>
                        <a href="dashboard.htm">
                            <img class="img-fluid" src="libraries/assets/images/logo.png" height="50px" width="50px" alt="Theme-Logo">
                            <span class="font-italic font-weight-bold text-uppercase text-warning text-center">SECRETARIA|Alda Lara</span>
                        </a>
                        <a class="mobile-options"><i class="feather icon-more-horizontal"></i></a>
                    </div>
                    <div class="navbar-container container-fluid">
                        <ul class="nav-left">
                            <li class="header-search">
                                <div class="main-search morphsearch-search">
                                    <div class="input-group">
                                        <span class="input-group-addon search-close"><i class="feather icon-x"></i></span>
                                        <input type="text" class="form-control" placeholder="Pesquisar coordenador...">
                                        <span class="input-group-addon search-btn"><i class="feather icon-search"></i></span>
                                    </div>
                                </div>
                            </li>
                            <li><a href="#!" onclick="javascript:toggleFullScreen()"><i class="feather icon-maximize full-screen"></i></a></li>
                        </ul>
                        <ul class="nav-right">
                            <li class="header-notification">
                                <div class="dropdown-primary dropdown">
                                    <div class="dropdown-toggle" data-toggle="dropdown">
                                        <i class="feather icon-bell"></i>
                                        <span class="badge bg-c-pink">5</span>
                                    </div>
                                    <ul class="show-notification notification-view dropdown-menu" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                                        <li><h6>Notificações</h6><label class="label label-danger">Novo</label></li>
                                        <li>
                                            <div class="media">
                                                <img class="d-flex align-self-center img-radius" src="libraries/assets/images/avatar-4.jpg" alt="Generic placeholder image">
                                                <div class="media-body">
                                                    <h5 class="notification-user">Secretaria</h5>
                                                    <p class="notification-msg">Novos coordenadores cadastrados</p>
                                                    <span class="notification-time">Hoje</span>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="user-profile header-notification">
                                <div class="dropdown-primary dropdown">
                                    <div class="dropdown-toggle" data-toggle="dropdown">
                                        <img src="libraries/assets/images/avatar-4.jpg" class="img-radius" alt="User-Profile-Image">
                                        <span>Usuário Secretaria</span>
                                        <i class="feather icon-chevron-down"></i>
                                    </div>
                                    <ul class="show-notification profile-notification dropdown-menu" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                                        <li><a href="user-profile.htm"><i class="feather icon-user"></i> Perfil</a></li>
                                        <li><a href="login.htm"><i class="feather icon-log-out"></i> Sair</a></li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Sidebar -->
            <div class="pcoded-main-container">
                <div class="pcoded-wrapper">
                    <nav class="pcoded-navbar">
                        <div class="pcoded-inner-navbar main-menu">
                            <div class="pcoded-navigatio-lavel">Navegação</div>
                            <ul class="pcoded-item pcoded-left-item">
                                <li class="pcoded-hasmenu active pcoded-trigger">
                                    <a href="javascript:void(0)"><span class="pcoded-micon"><i class="feather icon-home"></i></span>
                                    <span class="pcoded-mtext">Dashboard</span></a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/matriculas.php"><span class="pcoded-micon"><i class="feather icon-user-plus"></i></span>
                                    <span class="pcoded-mtext">Matrículas</span></a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/alunos.php"><span class="pcoded-micon"><i class="feather icon-users"></i></span>
                                    <span class="pcoded-mtext">Gerenciar Alunos</span></a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/professores.php"><span class="pcoded-micon"><i class="feather icon-users"></i></span>
                                    <span class="pcoded-mtext">Gerenciar Professores</span></a>
                                </li>
                                <li class="pcoded-hasmenu active">
                                    <a href="/secretaria/coordenadores.php"><span class="pcoded-micon"><i class="feather icon-users"></i></span>
                                    <span class="pcoded-mtext">Gerenciar Coordenadores</span></a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/turmas.php"><span class="pcoded-micon"><i class="feather icon-layers"></i></span>
                                    <span class="pcoded-mtext">Gerenciar Turmas</span></a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/documentos.php"><span class="pcoded-micon"><i class="feather icon-file-text"></i></span>
                                    <span class="pcoded-mtext">Documentos</span></a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/relatorios.php"><span class="pcoded-micon"><i class="feather icon-bar-chart"></i></span>
                                    <span class="pcoded-mtext">Relatórios</span></a>
                                </li>
                            </ul>
                        </div>
                    </nav>

                    <!-- Conteúdo Principal -->
                    <div class="pcoded-content">
                        <div class="pcoded-inner-content">
                            <div class="main-body bg-img">
                                <div class="page-wrapper">
                                    <div class="page-body">
                                        <div class="row">
                                            <div class="col-12 mt-4">
                                                <!-- Tabela de Diretores -->
                                                <div class="card card-table">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <h5 class="text-white mb-0">Lista de Diretores</h5>
                                                        <div>
                                                            <button class="btn btn-primary mr-2" onclick="novoDiretor()" data-toggle="modal" data-target="#modalDiretor">
                                                                <i class="feather icon-plus"></i> Novo Diretor
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="table-responsive">
                                                            <table class="table table-custom" id="tabelaDiretores">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Tipo</th>
                                                                        <th>Nome</th>
                                                                        <th>BI</th>
                                                                        <th>Email</th>
                                                                        <th>Status</th>
                                                                        <th>Ações</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <?php if (empty($diretores)): ?>
                                                                    <tr>
                                                                        <td colspan="6" class="text-center">Nenhum diretor encontrado</td>
                                                                    </tr>
                                                                    <?php else: ?>
                                                                    <?php foreach ($diretores as $diretor): ?>
                                                                    <tr>
                                                                        <td>
                                                                            <span class="badge badge-<?= $diretor['tipo'] === 'diretor_geral' ? 'diretor-geral' : 'diretor-pedagogico' ?>">
                                                                                <?= $diretor['tipo'] === 'diretor_geral' ? 'Diretor Geral' : 'Diretor Pedagógico' ?>
                                                                            </span>
                                                                        </td>
                                                                        <td><?= htmlspecialchars($diretor['nome']) ?></td>
                                                                        <td><?= htmlspecialchars($diretor['bi_numero']) ?></td>
                                                                        <td><?= htmlspecialchars($diretor['email']) ?></td>
                                                                        <td>
                                                                            <span class="badge <?= $diretor['status'] == 'ativo' ? 'badge-success' : 'badge-danger' ?>">
                                                                                <?= ucfirst($diretor['status']) ?>
                                                                            </span>
                                                                        </td>
                                                                        <td class="action-buttons">
                                                                            <button class="btn btn-warning btn-sm" onclick="editarDiretor(<?= $diretor['id_usuario'] ?>, '<?= $diretor['tipo'] ?>')">
                                                                                <i class="feather icon-edit"></i> Editar
                                                                            </button>
                                                                            <button class="btn btn-danger btn-sm" onclick="confirmarExclusao(<?= $diretor['id_usuario'] ?>, '<?= $diretor['tipo'] === 'diretor_geral' ? 'Diretor Geral' : 'Diretor Pedagógico' ?>')">
                                                                                <i class="feather icon-trash"></i> Excluir
                                                                            </button>
                                                                        </td>
                                                                    </tr>
                                                                    <?php endforeach; ?>
                                                                    <?php endif; ?>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Modal Diretor -->
                                                <div class="modal fade" id="modalDiretor" tabindex="-1" role="dialog" aria-labelledby="modalDiretorLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header bg-primary text-white">
                                                                <h5 class="modal-title" id="modalDiretorLabel">Novo Diretor</h5>
                                                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="formDiretor" method="POST" action="salvar_diretor.php">
                                                                    <input type="hidden" id="diretorId" name="diretorId">
                                                                    
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="tipo">Tipo de Diretor *</label>
                                                                                <select class="form-control" id="tipo" name="tipo" required>
                                                                                    <option value="">Selecione...</option>
                                                                                    <option value="diretor_geral" <?= $diretorGeralExistente ? 'disabled' : '' ?>>Diretor Geral</option>
                                                                                    <option value="diretor_pedagogico" <?= $diretorPedagogicoExistente ? 'disabled' : '' ?>>Diretor Pedagógico</option>
                                                                                </select>
                                                                                <?php if ($diretorGeralExistente || $diretorPedagogicoExistente): ?>
                                                                                <small class="form-text text-warning">
                                                                                    <?= $diretorGeralExistente ? 'Já existe um Diretor Geral cadastrado.<br>' : '' ?>
                                                                                    <?= $diretorPedagogicoExistente ? 'Já existe um Diretor Pedagógico cadastrado.<br>' : '' ?>
                                                                                    Para cadastrar um novo, primeiro exclua o existente.
                                                                                </small>
                                                                                <?php endif; ?>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="status">Status *</label>
                                                                                <select class="form-control" id="status" name="status" required>
                                                                                    <option value="ativo" selected>Ativo</option>
                                                                                    <option value="inativo">Inativo</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="nome">Nome Completo *</label>
                                                                                <input type="text" class="form-control" id="nome" name="nome" required>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="bi_numero">Nº do BI *</label>
                                                                                <input type="text" class="form-control" id="bi_numero" name="bi_numero" 
                                                                                    pattern="[0-9]{9}[A-Z]{2}[0-9]{3}" required>
                                                                                <small class="form-text text-muted">Formato: 123456789LA123</small>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="email">Email *</label>
                                                                                <input type="email" class="form-control" id="email" name="email" required>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="senha">Senha <?= isset($diretorId) ? '(Deixe em branco para manter a atual)' : '*' ?></label>
                                                                                <input type="password" class="form-control" id="senha" name="senha" <?= !isset($diretorId) ? 'required' : '' ?>>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                                            <i class="feather icon-x"></i> Cancelar
                                                                        </button>
                                                                        <button type="submit" class="btn btn-primary">
                                                                            <i class="feather icon-save"></i> Salvar
                                                                        </button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    

    <!-- Scripts -->
    <script src="libraries/bower_components/jquery/js/jquery.min.js"></script>
    <script src="libraries/bower_components/jquery-ui/js/jquery-ui.min.js"></script>
    <script src="libraries/bower_components/popper.js/js/popper.min.js"></script>
    <script src="libraries/bower_components/bootstrap/js/bootstrap.min.js"></script>
    <script src="libraries/bower_components/jquery-slimscroll/js/jquery.slimscroll.js"></script>
    <script src="libraries/bower_components/modernizr/js/modernizr.js"></script>
    <script src="libraries/assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="libraries/assets/js/pcoded.min.js"></script>
    <script src="libraries/assets/js/vartical-layout.min.js"></script>
    <script src="libraries/assets/js/script.min.js"></script>

    <script>
    // Funções do Sistema
    function novoDiretor() {
        $('#formDiretor')[0].reset();
        $('#diretorId').val('');
        $('#modalDiretorLabel').text('Novo Diretor');
        $('#tipo').prop('disabled', false);
    }
    
    function editarDiretor(id, tipo) {
        $.ajax({
            url: 'getDiretor.php',
            method: 'GET',
            data: { id: id },
            dataType: 'json',
            success: function(diretor) {
                $('#diretorId').val(diretor.id_usuario);
                $('#nome').val(diretor.nome);
                $('#bi_numero').val(diretor.bi_numero);
                $('#email').val(diretor.email);
                $('#tipo').val(diretor.tipo);
                $('#status').val(diretor.status);
                
                // Não preenche a senha por questões de segurança
                $('#senha').val('');
                $('#senha').removeAttr('required');
                
                // Desabilita o campo tipo na edição
                $('#tipo').prop('disabled', true);
                
                $('#modalDiretorLabel').text('Editar Diretor: ' + diretor.nome);
                $('#modalDiretor').modal('show');
            },
            error: function() {
                alert('Erro ao carregar dados do diretor');
            }
        });
    }
    
    function confirmarExclusao(id) {
        if(confirm('Tem certeza que deseja excluir este diretor?\nEsta ação não pode ser desfeita.')) {
            $.ajax({
                url: 'excluir_diretor.php',
                method: 'POST',
                data: { id: id },
                dataType: 'json',
                success: function(response) {
                    if(response.success) {
                        alert(response.message);
                        location.reload();
                    } else {
                        alert('Erro ao excluir: ' + response.message);
                    }
                },
                error: function() {
                    alert('Erro na comunicação com o servidor');
                }
            });
        }
    }
    
    // Validação do formulário de diretor
    $('#formDiretor').submit(function(e) {
        e.preventDefault();
        
        if(!validarBI($('#bi_numero').val())) {
            alert('Número de BI inválido. Formato correto: 123456789LA123');
            return false;
        }
        
        $.ajax({
            url: $(this).attr('action'),
            method: 'POST',
            data: $(this).serialize(),
            dataType: 'json',
            success: function(response) {
                if(response.success) {
                    alert(response.message);
                    location.reload();
                } else {
                    alert('Erro: ' + response.message);
                }
            },
            error: function() {
                alert('Erro na comunicação com o servidor');
            }
        });
    });
    
    function validarBI(bi) {
        const regex = /^[0-9]{9}[A-Z]{2}[0-9]{3}$/;
        return regex.test(bi);
    }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt">

<head>
    <title>SECRETARIA</title>
    <!-- HTML5 Shim and Respond.js IE10 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 10]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="#">
    <meta name="keywords" content="Admin , Responsive, Landing, Bootstrap, App, Template, Mobile, iOS, Android, apple, creative app">
    <meta name="author" content="#">
    <!-- Favicon icon -->
    <link rel="icon" href="libraries\assets\images\favicon.ico" type="image/x-icon">
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet">
    <!-- Required Fremwork -->
    <link rel="stylesheet" type="text/css" href="libraries\bower_components\bootstrap\css\bootstrap.min.css">
    <!-- feather Awesome -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\icon\feather\css\feather.css">
    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\style.css">
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\jquery.mCustomScrollbar.css">

    <style>
        .bg-img {
          width: 100%; /* Ou um valor específico, como 500px */
          height: auto; /* Defina a altura conforme necessário */
          background-image: url('../public/img/bg.jpg'); /* Caminho da imagem */
          background-size: cover; /* Faz com que a imagem cubra toda a div */
          background-position: center; /* Centraliza a imagem */
          background-repeat: no-repeat; /* Evita repetições da imagem */
        }

        .table-custom {
            background: rgba(255, 255, 255, 0.2); /* Branco bem transparente */
            backdrop-filter: blur(8px); /* Efeito vidro fosco */
            border-radius: 10px; /* Bordas arredondadas */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda branca fraca */
            color: white; /* Texto branco para contraste */
        }

        .table-custom th,
        .table-custom td {
            padding: 12px;
            color: #ffffff; /* Texto branco */
        }

        .table-custom thead {
            background: rgba(7, 200, 206, 0.55); /* Azul mais transparente */
            color: white;
            font-weight: bold;
        }

        .table-custom tbody tr:hover {
            background: rgba(255, 255, 255, 0.3); /* Efeito ao passar o mouse */
            transition: 0.3s;
        }

        /* Estilo específico para os cards que contêm tabelas */
        .card-table {
            background: rgba(19, 125, 171, 0.082); /* Fundo branco com transparência */
            backdrop-filter: blur(10px); /* Efeito vidro fosco */
            border-radius: 10px; /* Bordas arredondadas */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Borda sutil */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra leve */
            color: white !important;
        }

        /* Ajuste no cabeçalho do card */
        .card-table .card-header {
            background: rgba(7, 200, 206, 0.836); /* Azul translúcido */
            color: white !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Estilo da tabela dentro do card */
        .card-table .table {
            background: transparent; /* Mantém a tabela transparente dentro do card */
        }
    </style>
      
</head>

<body>
    <!-- Pre-loader start -->
    <div class="theme-loader">
        <div class="ball-scale">
            <div class='contain'>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Pre-loader end -->
    <div id="pcoded" class="pcoded">
        <div class="pcoded-overlay-box"></div>
        <div class="pcoded-container navbar-wrapper">

            <nav class="navbar header-navbar pcoded-header">
                <div class="navbar-wrapper">

                    <div class="navbar-logo">
                        <a class="mobile-menu" id="mobile-collapse" href="#!">
                            <i class="feather icon-menu"></i>
                        </a>
                        <a href="dashboard.htm">
                            <img class="img-fluid" src="libraries\assets\images\logo.png" height="50px" width="50px" alt="Theme-Logo"> <span class="font-italic font-weight-bold text-uppercase text-warning text-center">SECRETARIA|Alda Lara</span>
                        </a>
                        <a class="mobile-options">
                            <i class="feather icon-more-horizontal"></i>
                        </a>
                    </div>

                    <div class="navbar-container container-fluid">
                        <ul class="nav-left">
                            <li class="header-search">
                                <div class="main-search morphsearch-search">
                                    <div class="input-group">
                                        <span class="input-group-addon search-close"><i class="feather icon-x"></i></span>
                                        <input type="text" class="form-control">
                                        <span class="input-group-addon search-btn"><i class="feather icon-search"></i></span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <a href="#!" onclick="javascript:toggleFullScreen()">
                                    <i class="feather icon-maximize full-screen"></i>
                                </a>
                            </li>
                        </ul>
                        <ul class="nav-right">
                            <li class="header-notification">
                                <div class="dropdown-primary dropdown">
                                    <div class="dropdown-toggle" data-toggle="dropdown">
                                        <i class="feather icon-bell"></i>
                                        <span class="badge bg-c-pink">5</span>
                                    </div>
                                    <ul class="show-notification notification-view dropdown-menu" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                                        <li>
                                            <h6>Notifications</h6>
                                            <label class="label label-danger">New</label>
                                        </li>
                                        <li>
                                            <div class="media">
                                                <img class="d-flex align-self-center img-radius" src="libraries\assets\images\avatar-4.jpg" alt="Generic placeholder image">
                                                <div class="media-body">
                                                    <h5 class="notification-user">Flavio Garcia</h5>
                                                    <p class="notification-msg">Lorem ipsum dolor sit amet, consectetuer elit.</p>
                                                    <span class="notification-time">30 minutes ago</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="media">
                                                <img class="d-flex align-self-center img-radius" src="libraries\assets\images\avatar-3.jpg" alt="Generic placeholder image">
                                                <div class="media-body">
                                                    <h5 class="notification-user">Jucelmo Pereira</h5>
                                                    <p class="notification-msg">Lorem ipsum dolor sit amet, consectetuer elit.</p>
                                                    <span class="notification-time">30 minutes ago</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="media">
                                                <img class="d-flex align-self-center img-radius" src="libraries\assets\images\avatar-4.jpg" alt="Generic placeholder image">
                                                <div class="media-body">
                                                    <h5 class="notification-user">Ariel Patricio</h5>
                                                    <p class="notification-msg">Lorem ipsum dolor sit amet, consectetuer elit.</p>
                                                    <span class="notification-time">30 minutes ago</span>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="user-profile header-notification">
                                <div class="dropdown-primary dropdown">
                                    <div class="dropdown-toggle" data-toggle="dropdown">
                                        <img src="libraries\assets\images\avatar-4.jpg" class="img-radius" alt="User-Profile-Image">
                                        <span>Flavio Garcia</span>
                                        <i class="feather icon-chevron-down"></i>
                                    </div>
                                    <ul class="show-notification profile-notification dropdown-menu" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                                        <li>
                                            <a href="#!">
                                                <i class="feather icon-settings"></i> Settings
                                            </a>
                                        </li>
                                        <li>
                                            <a href="user-profile.htm">
                                                <i class="feather icon-user"></i> Profile
                                            </a>
                                        </li>
                                        <li>
                                            <a href="email-inbox.htm">
                                                <i class="feather icon-mail"></i> My Messages
                                            </a>
                                        </li>
                                        <li>
                                            <a href="auth-lock-screen.htm">
                                                <i class="feather icon-lock"></i> Lock Screen
                                            </a>
                                        </li>
                                        <li>
                                            <a href="login.htm">
                                                <i class="feather icon-log-out"></i> Logout
                                            </a>
                                        </li>
                                    </ul>

                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!--sidebar-->
            <div class="pcoded-main-container">
                <div class="pcoded-wrapper">
                    <nav class="pcoded-navbar">
                        <div class="pcoded-inner-navbar main-menu">
                            <div class="pcoded-navigatio-lavel">Navegacao</div>
                            <ul class="pcoded-item pcoded-left-item">
                                <li class="pcoded-hasmenu active pcoded-trigger">
                                    <a href="javascript:void(0)">
                                        <span class="pcoded-micon"><i class="feather icon-home"></i></span>
                                        <span class="pcoded-mtext">Dashboard</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="javascript:void(0)">
                                        <span class="pcoded-micon"><i class="feather icon-user-plus"></i></span>
                                        <span class="pcoded-mtext">Matrículas</span>
                                    </a>
                                    <ul class="pcoded-submenu">
                                        <li class=" ">
                                            <a href="matricula.php">
                                                <span class="pcoded-mtext">Matrículas</span>
                                            </a>
                                        </li>
                                        <li class=" ">
                                            <a href="#">
                                                <span class="pcoded-mtext">Transferências</span>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/alunos.php">
                                        <span class="pcoded-micon"><i class="feather icon-users"></i></span>
                                        <span class="pcoded-mtext">Gerenciar Alunos</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/turmas.php">
                                        <span class="pcoded-micon"><i class="feather icon-layers"></i></span>
                                        <span class="pcoded-mtext">Gerenciar Turmas</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/documentos.php">
                                        <span class="pcoded-micon"><i class="feather icon-file-text"></i></span>
                                        <span class="pcoded-mtext">Documentos Admins.</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/comunicados.php">
                                        <span class="pcoded-micon"><i class="feather icon-mail"></i></span>
                                        <span class="pcoded-mtext">Envio de Comunicados</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/relatorios.php">
                                        <span class="pcoded-micon"><i class="feather icon-bar-chart"></i></span>
                                        <span class="pcoded-mtext">Relatórios Acadêmicos</span>
                                    </a>
                                </li>
                                
                            </ul>
                        </div>
                    </nav>
                    <div class="pcoded-content">
                        <div class="pcoded-inner-content">
                            <div class="main-body bg-img">
                                <div class="page-wrapper">

                                    <div class="page-body">
                                        <div class="row">
                                            <!-- Total de Alunos Ativos -->
                                            <a href="/secretaria/alunos.php" class="col-xl-3 col-md-6 d-block text-decoration-none text-reset">
                                                <div class="card bg-c-yellow update-card">
                                                    <div class="card-block">
                                                        <div class="row align-items-end">
                                                            <div class="col-8">
                                                                <h4 class="text-white">850</h4>
                                                                <h6 class="text-white m-b-0">
                                                                    <i class="feather icon-users"></i> Alunos Ativos
                                                                </h6>
                                                            </div>
                                                            <div class="col-4 text-right">
                                                                <i class="feather icon-users text-white" style="font-size: 40px;"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer">
                                                        <p class="text-white m-b-0">
                                                            <i class="feather icon-clock text-white f-14 m-r-10"></i> Atualizado: Hoje
                                                        </p>
                                                    </div>
                                                </div>
                                            </a>
                                        
                                            <!-- Alunos Transferidos Recentemente -->
                                            <a href="/secretaria/matriculas.php?tipo=transferencias" class="col-xl-3 col-md-6 d-block text-decoration-none text-reset">
                                                <div class="card bg-c-green update-card">
                                                    <div class="card-block">
                                                        <div class="row align-items-end">
                                                            <div class="col-8">
                                                                <h4 class="text-white">35</h4>
                                                                <h6 class="text-white m-b-0">
                                                                    <i class="feather icon-refresh-ccw"></i> Transferências Recentes
                                                                </h6>
                                                            </div>
                                                            <div class="col-4 text-right">
                                                                <i class="feather icon-refresh-ccw text-white" style="font-size: 40px;"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer">
                                                        <p class="text-white m-b-0">
                                                            <i class="feather icon-clock text-white f-14 m-r-10"></i> Atualizado: Hoje
                                                        </p>
                                                    </div>
                                                </div>
                                            </a>
                                        
                                            <!-- Matrículas Pendentes -->
                                            <a href="/secretaria/matriculas.php?tipo=pendentes" class="col-xl-3 col-md-6 d-block text-decoration-none text-reset">
                                                <div class="card bg-c-pink update-card">
                                                    <div class="card-block">
                                                        <div class="row align-items-end">
                                                            <div class="col-8">
                                                                <h4 class="text-white">12</h4>
                                                                <h6 class="text-white m-b-0">
                                                                    <i class="feather icon-edit"></i> Matrículas Pendentes
                                                                </h6>
                                                            </div>
                                                            <div class="col-4 text-right">
                                                                <i class="feather icon-edit text-white" style="font-size: 40px;"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-footer">
                                                        <p class="text-white m-b-0">
                                                            <i class="feather icon-clock text-white f-14 m-r-10"></i> Atualizado: Hoje
                                                        </p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                        
                                        <!-- Tabela com Últimos Registros (Matrículas e Transferências) -->
                                        <div class="card card-table">
                                            <div class="card-header">
                                                <h5>Últimos Registros (Matrículas e Transferências)</h5>
                                            </div>
                                            <div class="card-block table-border-style">
                                                <div class="table-responsive">
                                                    <table class="table table-bordered table-custom">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Aluno</th>
                                                                <th>Turma</th>
                                                                <th>Tipo</th>
                                                                <th>Data</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <th scope="row">1</th>
                                                                <td>João Silva</td>
                                                                <td>I11AM</td>
                                                                <td>Matrícula</td>
                                                                <td>10/03/2025</td>
                                                            </tr>
                                                            <tr>
                                                                <th scope="row">2</th>
                                                                <td>Maria Santos</td>
                                                                <td>I11BM</td>
                                                                <td>Transferência</td>
                                                                <td>09/03/2025</td>
                                                            </tr>
                                                            <tr>
                                                                <th scope="row">3</th>
                                                                <td>Carlos Oliveira</td>
                                                                <td>I11CM</td>
                                                                <td>Matrícula</td>
                                                                <td>08/03/2025</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Warning Section Ends -->
    <!-- Required Jquery -->
    <script data-cfasync="false" src="..\..\..\cdn-cgi\scripts\5c5dd728\cloudflare-static\email-decode.min.js"></script><script type="text/javascript" src="libraries\bower_components\jquery\js\jquery.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\jquery-ui\js\jquery-ui.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\popper.js\js\popper.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\bootstrap\js\bootstrap.min.js"></script>
    <!-- jquery slimscroll js -->
    <script type="text/javascript" src="libraries\bower_components\jquery-slimscroll\js\jquery.slimscroll.js"></script>
    <!-- modernizr js -->
    <script type="text/javascript" src="libraries\bower_components\modernizr\js\modernizr.js"></script>
    <!-- Chart js -->
    <script type="text/javascript" src="libraries\bower_components\chart.js\js\Chart.js"></script>
    <!-- amchart js -->
    <script src="libraries\assets\pages\widget\amchart\amcharts.js"></script>
    <script src="libraries\assets\pages\widget\amchart\serial.js"></script>
    <script src="libraries\assets\pages\widget\amchart\light.js"></script>
    <script src="libraries\assets\js\jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="libraries\assets\js\SmoothScroll.js"></script>
    <script src="libraries\assets\js\pcoded.min.js"></script>
    <!-- custom js -->
    <script src="libraries\assets\js\vartical-layout.min.js"></script>
    <script type="text/javascript" src="libraries\assets\js\script.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>
</body>

</html>
 para endireitar esse  mas mantendo a essencia de todas as suas funcionalidades <?php
require_once 'conexao.php';
session_start();



// Processar formulário de nova matrícula
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['nova_matricula'])) {
    // Validar e sanitizar dados
    $id_aluno = intval($_POST['id_aluno']);
    $id_curso = intval($_POST['id_curso']);
    $id_turma = intval($_POST['id_turma']);
    $ano_letivo = intval($_POST['ano_letivo']);
    $classe = $_POST['classe'];
    $turno = $_POST['turno'];
    
    // Gerar número de matrícula automático (formato: AL-ANO-SEQUENCIAL)
    $stmt = $conn->prepare("SELECT MAX(id_matricula) as ultimo_id FROM matricula WHERE ano_letivo = ?");
    $stmt->bind_param("i", $ano_letivo);
    $stmt->execute();
    $result = $stmt->get_result();
    $row = $result->fetch_assoc();
    $sequencial = $row['ultimo_id'] ? $row['ultimo_id'] + 1 : 1;
    $numero_matricula = 'AL-' . $ano_letivo . '-' . str_pad($sequencial, 4, '0', STR_PAD_LEFT);
    
    // Inserir matrícula
    $stmt = $conn->prepare("INSERT INTO matricula 
        (ano_letivo, classe, turno, numero_matricula, data_matricula, 
         turma_id_turma, aluno_id_aluno, curso_id_curso, status_matricula, comprovativo_pagamento) 
        VALUES (?, ?, ?, ?, NOW(), ?, ?, ?, 'ativa', 'confirmado')");
    $stmt->bind_param("isssiii", $ano_letivo, $classe, $turno, $numero_matricula, $id_turma, $id_aluno, $id_curso);
    
    if ($stmt->execute()) {
        // Atualizar aluno com turma e curso
        $stmt = $conn->prepare("UPDATE aluno SET turma_id_turma = ?, curso_id_curso = ? WHERE id_aluno = ?");
        $stmt->bind_param("iii", $id_turma, $id_curso, $id_aluno);
        $stmt->execute();
        
        $_SESSION['sucesso'] = "Matrícula registrada com sucesso! Número: $numero_matricula";
    } else {
        $_SESSION['erro'] = "Erro ao registrar matrícula: " . $conn->error;
    }
    
    header('Location: matriculas.php');
    exit();
}

// Filtros
$status = isset($_GET['status']) ? $_GET['status'] : 'ativa';
$id_curso = isset($_GET['id_curso']) ? intval($_GET['id_curso']) : null;
$ano_letivo = isset($_GET['ano_letivo']) ? intval($_GET['ano_letivo']) : date('Y');

// Obter matrículas com filtros
$query = "SELECT m.id_matricula, a.id_aluno, u.nome, u.bi_numero, 
          c.nome AS curso, t.nome AS turma, m.data_matricula, 
          m.ano_letivo, m.classe, m.turno, m.numero_matricula,
          m.status_matricula
          FROM matricula m
          JOIN aluno a ON m.aluno_id_aluno = a.id_aluno
          JOIN usuario u ON a.usuario_id_usuario = u.id_usuario
          LEFT JOIN curso c ON m.curso_id_curso = c.id_curso
          LEFT JOIN turma t ON m.turma_id_turma = t.id_turma
          WHERE m.ano_letivo = ?";

$params = [$ano_letivo];
$types = "i";

if ($status != 'todos') {
    $query .= " AND m.status_matricula = ?";
    $params[] = $status;
    $types .= "s";
}

if ($id_curso) {
    $query .= " AND m.curso_id_curso = ?";
    $params[] = $id_curso;
    $types .= "i";
}

$query .= " ORDER BY m.data_matricula DESC";

$stmt = $conn->prepare($query);

if ($params) {
    $stmt->bind_param($types, ...$params);
}

$stmt->execute();
$result = $stmt->get_result();
$matriculas = $result->fetch_all(MYSQLI_ASSOC);

// Obter cursos para filtros
$result_cursos = $conn->query("SELECT id_curso, nome FROM curso ORDER BY nome");
$cursos = $result_cursos->fetch_all(MYSQLI_ASSOC);

// Obter alunos não matriculados no ano letivo
$stmt_nao_matriculados = $conn->prepare("SELECT a.id_aluno, u.nome, u.bi_numero 
                                       FROM aluno a
                                       JOIN usuario u ON a.usuario_id_usuario = u.id_usuario
                                       WHERE a.id_aluno NOT IN 
                                       (SELECT aluno_id_aluno FROM matricula WHERE ano_letivo = ?)");
$stmt_nao_matriculados->bind_param("i", $ano_letivo);
$stmt_nao_matriculados->execute();
$result_nao_matriculados = $stmt_nao_matriculados->get_result();
$alunos_nao_matriculados = $result_nao_matriculados->fetch_all(MYSQLI_ASSOC);

// Obter turmas para select
$turmas = [];
if ($result_turmas = $conn->query("SELECT id_turma, nome, curso_id_curso FROM turma")) {
    $turmas = $result_turmas->fetch_all(MYSQLI_ASSOC);
}
?>

<!DOCTYPE html>
<html lang="pt">
<head>
    <title>SECRETARIA - Gestão de Matrículas | Alda Lara</title>
    <?php //include_once 'head.php'; ?>
    <style>
        .card-matricula {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .badge-ativa { background-color: #28a745; color: #fff; }
        .badge-cancelada { background-color: #dc3545; color: #fff; }
        .badge-trancada { background-color: #ffc107; color: #000; }
        .filtros-container {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .table-responsive {
            overflow-x: auto;
        }
        .numero-matricula {
            font-family: monospace;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <!-- Pre-loader start -->
    <div class="theme-loader">
        <div class="ball-scale">
            <div class='contain'>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
                <div class="ring">
                    <div class="frame"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Pre-loader end -->
     
    <div id="pcoded" class="pcoded">
        <div class="pcoded-overlay-box"></div>
        <div class="pcoded-container navbar-wrapper">
            <?php include 'navbar.php'; ?>
            
            <div class="pcoded-main-container">
                <div class="pcoded-wrapper">
                    <?php include 'sidebar.php'; ?>
                    
                    <div class="pcoded-content">
                        <div class="pcoded-inner-content">
                            <div class="main-body">
                                <div class="page-wrapper">
                                    <div class="page-body">
                                        <!-- Mensagens de feedback -->
                                        <?php if (isset($_SESSION['sucesso'])): ?>
                                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                                            <?= $_SESSION['sucesso'] ?>
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <?php unset($_SESSION['sucesso']); endif; ?>
                                        
                                        <?php if (isset($_SESSION['erro'])): ?>
                                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                            <?= $_SESSION['erro'] ?>
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <?php unset($_SESSION['erro']); endif; ?>
                                        
                                        <div class="row">
                                            <div class="col-12 mt-4">
                                                <!-- Filtros -->
                                                <div class="card card-matricula mb-3">
                                                    <div class="card-header">
                                                        <h5>Filtrar Matrículas</h5>
                                                    </div>
                                                    <div class="card-body">
                                                        <form id="formFiltros" method="GET" action="">
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="status">Status</label>
                                                                        <select class="form-control" id="status" name="status">
                                                                            <option value="ativa" <?= $status == 'ativa' ? 'selected' : '' ?>>Ativas</option>
                                                                            <option value="cancelada" <?= $status == 'cancelada' ? 'selected' : '' ?>>Canceladas</option>
                                                                            <option value="trancada" <?= $status == 'trancada' ? 'selected' : '' ?>>Trancadas</option>
                                                                            <option value="todos" <?= $status == 'todos' ? 'selected' : '' ?>>Todos</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="id_curso">Curso</label>
                                                                        <select class="form-control" id="id_curso" name="id_curso">
                                                                            <option value="">Todos os cursos</option>
                                                                            <?php foreach ($cursos as $curso): ?>
                                                                            <option value="<?= $curso['id_curso'] ?>" <?= $id_curso == $curso['id_curso'] ? 'selected' : '' ?>>
                                                                                <?= htmlspecialchars($curso['nome']) ?>
                                                                            </option>
                                                                            <?php endforeach; ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="ano_letivo">Ano Letivo</label>
                                                                        <select class="form-control" id="ano_letivo" name="ano_letivo">
                                                                            <option value="<?= date('Y')-1 ?>"><?= date('Y')-1 ?></option>
                                                                            <option value="<?= date('Y') ?>" selected><?= date('Y') ?></option>
                                                                            <option value="<?= date('Y')+1 ?>"><?= date('Y')+1 ?></option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3 d-flex align-items-end">
                                                                    <button type="submit" class="btn btn-primary btn-block">
                                                                        <i class="feather icon-filter"></i> Filtrar
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>

                                                <!-- Tabela de Matrículas -->
                                                <div class="card card-matricula">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <h5 class="mb-0">Gestão de Matrículas - Ano Letivo <?= $ano_letivo ?></h5>
                                                        <div>
                                                            <button class="btn btn-primary" data-toggle="modal" data-target="#modalNovaMatricula">
                                                                <i class="feather icon-plus"></i> Nova Matrícula
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="table-responsive">
                                                            <table class="table table-hover">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Nº Matrícula</th>
                                                                        <th>Aluno</th>
                                                                        <th>BI</th>
                                                                        <th>Curso</th>
                                                                        <th>Turma</th>
                                                                        <th>Classe</th>
                                                                        <th>Turno</th>
                                                                        <th>Data</th>
                                                                        <th>Status</th>
                                                                        <th>Ações</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <?php if (empty($matriculas)): ?>
                                                                    <tr>
                                                                        <td colspan="10" class="text-center">Nenhuma matrícula encontrada com os filtros selecionados</td>
                                                                    </tr>
                                                                    <?php else: ?>
                                                                    <?php foreach ($matriculas as $matricula): ?>
                                                                    <tr>
                                                                        <td class="numero-matricula"><?= htmlspecialchars($matricula['numero_matricula']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['nome']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['bi_numero']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['curso'] ?? 'N/D') ?></td>
                                                                        <td><?= htmlspecialchars($matricula['turma'] ?? 'N/D') ?></td>
                                                                        <td><?= htmlspecialchars($matricula['classe'] ?? 'N/D') ?></td>
                                                                        <td><?= htmlspecialchars($matricula['turno'] ?? 'N/D') ?></td>
                                                                        <td><?= date('d/m/Y', strtotime($matricula['data_matricula'])) ?></td>
                                                                        <td>
                                                                            <?php 
                                                                            $badge_class = '';
                                                                            if ($matricula['status_matricula'] == 'ativa') $badge_class = 'badge-ativa';
                                                                            elseif ($matricula['status_matricula'] == 'cancelada') $badge_class = 'badge-cancelada';
                                                                            else $badge_class = 'badge-trancada';
                                                                            ?>
                                                                            <span class="badge <?= $badge_class ?>">
                                                                                <?= ucfirst($matricula['status_matricula']) ?>
                                                                            </span>
                                                                        </td>
                                                                        <td>
                                                                            <div class="btn-group btn-group-sm">
                                                                                <button class="btn btn-info btn-action" onclick="editarMatricula(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-edit"></i>
                                                                                </button>
                                                                                <button class="btn btn-secondary btn-action" onclick="emitirComprovante(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-printer"></i>
                                                                                </button>
                                                                                <button class="btn btn-danger btn-action" onclick="cancelarMatricula(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-x"></i>
                                                                                </button>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    <?php endforeach; ?>
                                                                    <?php endif; ?>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Matrícula -->
    <div class="modal fade" id="modalNovaMatricula" tabindex="-1" role="dialog" aria-labelledby="modalNovaMatriculaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalNovaMatriculaLabel">Nova Matrícula</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formMatricula" method="POST" action="">
                        <input type="hidden" name="nova_matricula" value="1">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="id_aluno">Aluno *</label>
                                    <select class="form-control" id="id_aluno" name="id_aluno" required>
                                        <option value="">Selecione um aluno</option>
                                        <?php foreach ($alunos_nao_matriculados as $aluno): ?>
                                        <option value="<?= $aluno['id_aluno'] ?>">
                                            <?= htmlspecialchars($aluno['nome']) ?> - BI: <?= htmlspecialchars($aluno['bi_numero']) ?>
                                        </option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="ano_letivo_matricula">Ano Letivo *</label>
                                    <select class="form-control" id="ano_letivo_matricula" name="ano_letivo" required>
                                        <option value="<?= date('Y') ?>" selected><?= date('Y') ?></option>
                                        <option value="<?= date('Y')+1 ?>"><?= date('Y')+1 ?></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="curso_matricula">Curso *</label>
                                    <select class="form-control" id="curso_matricula" name="id_curso" required>
                                        <option value="">Selecione um curso</option>
                                        <?php foreach ($cursos as $curso): ?>
                                        <option value="<?= $curso['id_curso'] ?>"><?= htmlspecialchars($curso['nome']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="turma_matricula">Turma *</label>
                                    <select class="form-control" id="turma_matricula" name="id_turma" required>
                                        <option value="">Selecione um curso primeiro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="classe_matricula">Classe *</label>
                                    <select class="form-control" id="classe_matricula" name="classe" required>
                                        <option value="10ª">10ª Classe</option>
                                        <option value="11ª">11ª Classe</option>
                                        <option value="12ª">12ª Classe</option>
                                        <option value="13ª">13ª Classe</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="turno_matricula">Turno *</label>
                                    <select class="form-control" id="turno_matricula" name="turno" required>
                                        <option value="Manhã">Manhã</option>
                                        <option value="Tarde">Tarde</option>
                                        <option value="Noite">Noite</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Pagamento</label>
                                    <div class="form-control bg-success text-white">
                                        <i class="feather icon-check"></i> Confirmado (via Rupe)
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Registrar Matrícula</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Matrícula -->
    <div class="modal fade" id="modalEditarMatricula" tabindex="-1" role="dialog" aria-labelledby="modalEditarMatriculaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalEditarMatriculaLabel">Editar Matrícula</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formEditarMatricula" method="POST" action="atualizar_matricula.php">
                        <input type="hidden" id="editar_id_matricula" name="id_matricula">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Aluno</label>
                                    <input type="text" class="form-control" id="editar_nome_aluno" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Número de Matrícula</label>
                                    <input type="text" class="form-control" id="editar_numero_matricula" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="editar_curso">Curso *</label>
                                    <select class="form-control" id="editar_curso" name="id_curso" required>
                                        <option value="">Selecione um curso</option>
                                        <?php foreach ($cursos as $curso): ?>
                                        <option value="<?= $curso['id_curso'] ?>"><?= htmlspecialchars($curso['nome']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="editar_turma">Turma *</label>
                                    <select class="form-control" id="editar_turma" name="id_turma" required>
                                        <option value="">Selecione um curso primeiro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="editar_classe">Classe *</label>
                                    <select class="form-control" id="editar_classe" name="classe" required>
                                        <option value="10ª">10ª Classe</option>
                                        <option value="11ª">11ª Classe</option>
                                        <option value="12ª">12ª Classe</option>
                                        <option value="13ª">13ª Classe</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editar_turno">Turno *</label>
                                    <select class="form-control" id="editar_turno" name="turno" required>
                                        <option value="Manhã">Manhã</option>
                                        <option value="Tarde">Tarde</option>
                                        <option value="Noite">Noite</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editar_status">Status *</label>
                                    <select class="form-control" id="editar_status" name="status" required>
                                        <option value="ativa">Ativa</option>
                                        <option value="trancada">Trancada</option>
                                        <option value="cancelada">Cancelada</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-info">Atualizar Matrícula</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <?php include 'includes/scripts.php'; ?>
    
    <script>
        // Carregar turmas quando um curso é selecionado
        function carregarTurmas(id_curso, elemento) {
            if(id_curso) {
                $.ajax({
                    url: 'ajax/get_turmas.php',
                    method: 'GET',
                    data: { id_curso: id_curso },
                    success: function(response) {
                        $(elemento).html(response);
                    },
                    error: function() {
                        $(elemento).html('<option value="">Erro ao carregar turmas</option>');
                    }
                });
            } else {
                $(elemento).html('<option value="">Selecione um curso primeiro</option>');
            }
        }
        
        // Editar matrícula
        function editarMatricula(id) {
            $.ajax({
                url: 'ajax/get_matricula.php',
                method: 'GET',
                data: { id: id },
                dataType: 'json',
                success: function(matricula) {
                    $('#editar_id_matricula').val(matricula.id_matricula);
                    $('#editar_nome_aluno').val(matricula.nome);
                    $('#editar_numero_matricula').val(matricula.numero_matricula);
                    $('#editar_curso').val(matricula.curso_id_curso);
                    
                    // Carregar turmas do curso selecionado
                    carregarTurmas(matricula.curso_id_curso, '#editar_turma');
                    
                    // Aguardar um pouco para garantir que as turmas foram carregadas
                    setTimeout(function() {
                        $('#editar_turma').val(matricula.turma_id_turma);
                    }, 300);
                    
                    $('#editar_classe').val(matricula.classe);
                    $('#editar_turno').val(matricula.turno);
                    $('#editar_status').val(matricula.status_matricula);
                    
                    $('#modalEditarMatricula').modal('show');
                },
                error: function() {
                    alert('Erro ao carregar dados da matrícula');
                }
            });
        }
        
        // Cancelar matrícula
        function cancelarMatricula(id) {
            if(confirm('Deseja realmente cancelar esta matrícula?')) {
                $.ajax({
                    url: 'ajax/cancelar_matricula.php',
                    method: 'POST',
                    data: { id: id },
                    dataType: 'json',
                    success: function(response) {
                        if(response.success) {
                            alert('Matrícula cancelada com sucesso');
                            location.reload();
                        } else {
                            alert('Erro: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('Erro na comunicação com o servidor');
                    }
                });
            }
        }
        
        // Emitir comprovante
        function emitirComprovante(id) {
            window.open('comprovante_matricula.php?id=' + id, '_blank');
        }
        
        // Carregar turmas quando um curso é selecionado
        $(document).ready(function() {
            $('#curso_matricula').change(function() {
                carregarTurmas($(this).val(), '#turma_matricula');
            });
            
            $('#editar_curso').change(function() {
                carregarTurmas($(this).val(), '#editar_turma');
            });
        });
    </script>
</body>
</html>       <?php
require_once 'conexao.php';

// Filtros
$status = isset($_GET['status']) ? $_GET['status'] : 'pendente';
$id_curso = isset($_GET['id_curso']) ? intval($_GET['id_curso']) : null;
$ano_letivo = isset($_GET['ano_letivo']) ? intval($_GET['ano_letivo']) : date('Y');

// Obter matrículas com filtros
$query = "SELECT m.id_matricula, a.id_aluno, u.nome, 
          c.nome AS curso, t.nome AS turma, m.data_matricula, 
          m.ano_letivo
          FROM matricula m
          JOIN aluno a ON m.aluno_id_aluno = a.id_aluno
          JOIN usuario u ON a.usuario_id_usuario = u.id_usuario
          LEFT JOIN curso c ON m.curso_id_curso = c.id_curso
          LEFT JOIN turma t ON m.turma_id_turma = t.id_turma
          WHERE m.ano_letivo = ?";

$params = [$ano_letivo];
$types = "i"; // Ano letivo é inteiro

if ($id_curso) {
    $query .= " AND m.curso_id_curso = ?";
    $params[] = $id_curso;
    $types .= "i"; // ID curso é inteiro
}

$query .= " ORDER BY m.data_matricula DESC";

// Preparar e executar a consulta
$stmt = $conn->prepare($query);

if ($params) {
    $stmt->bind_param($types, ...$params);
}

$stmt->execute();
$result = $stmt->get_result();
$matriculas = $result->fetch_all(MYSQLI_ASSOC);

// Obter cursos para filtros
$result_cursos = $conn->query("SELECT id_curso, nome FROM curso ORDER BY nome");
$cursos = $result_cursos->fetch_all(MYSQLI_ASSOC);

// Obter alunos não matriculados no ano letivo
$stmt_nao_matriculados = $conn->prepare("SELECT a.id_aluno, u.nome 
                                       FROM aluno a
                                       JOIN usuario u ON a.usuario_id_usuario = u.id_usuario
                                       WHERE a.id_aluno NOT IN 
                                       (SELECT aluno_id_aluno FROM matricula WHERE ano_letivo = ?)");
$stmt_nao_matriculados->bind_param("i", $ano_letivo);
$stmt_nao_matriculados->execute();
$result_nao_matriculados = $stmt_nao_matriculados->get_result();
$alunos_nao_matriculados = $result_nao_matriculados->fetch_all(MYSQLI_ASSOC);
?>


<!DOCTYPE html>
<html lang="pt">
<!--<head>
    <title>SECRETARIA - Gestão de Matrículas | Alda Lara</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Sistema de Gestão Escolar - Escola Alda Lara">
    <meta name="keywords" content="Escola, Alda Lara, Angola, Luanda, Secretaria, Matrículas">
    <meta name="author" content="Escola Alda Lara">
    <link rel="icon" href="../libraries/assets/images/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../libraries/bower_components/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../libraries/assets/icon/feather/css/feather.css">
    <link rel="stylesheet" type="text/css" href="../libraries/assets/css/style.css">
    <link rel="stylesheet" type="text/css" href="../libraries/assets/css/jquery.mCustomScrollbar.css">
    <style>
        .card-matricula {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .badge-pendente { background-color: #ffc107; color: #000; }
        .badge-aprovada { background-color: #28a745; color: #fff; }
        .badge-rejeitada { background-color: #dc3545; color: #fff; }
        .badge-transferencia { background-color: #17a2b8; color: #fff; }
        .filtros-container {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .table-responsive {
            overflow-x: auto;
        }
        @media (max-width: 768px) {
            .btn-action {
                margin-bottom: 5px;
                width: 100%;
            }
        }
    </style>
</head>-->
<head>
    <title>SECRETARIA</title>
    <!-- HTML5 Shim and Respond.js IE10 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 10]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="#">
    <meta name="keywords" content="Admin , Responsive, Landing, Bootstrap, App, Template, Mobile, iOS, Android, apple, creative app">
    <meta name="author" content="#">
    <!-- Favicon icon -->
    <link rel="icon" href="libraries\assets\images\favicon.ico" type="image/x-icon">
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet">
    <!-- Required Fremwork -->
    <link rel="stylesheet" type="text/css" href="libraries\bower_components\bootstrap\css\bootstrap.min.css">
    <!-- feather Awesome -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\icon\feather\css\feather.css">
    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\style.css">
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\jquery.mCustomScrollbar.css">

    <style>
        .card-matricula {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .badge-pendente { background-color: #ffc107; color: #000; }
        .badge-aprovada { background-color: #28a745; color: #fff; }
        .badge-rejeitada { background-color: #dc3545; color: #fff; }
        .badge-transferencia { background-color: #17a2b8; color: #fff; }
        .filtros-container {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .table-responsive {
            overflow-x: auto;
        }
        @media (max-width: 768px) {
            .btn-action {
                margin-bottom: 5px;
                width: 100%;
            }
        }
    </style>
      
</head>
<body>
    <!-- Pre-loader -->
    <div class="theme-loader">
        <div class="ball-scale">
            <div class='contain'>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
            </div>
        </div>
    </div>

    <div id="pcoded" class="pcoded">
        <div class="pcoded-overlay-box"></div>
        <div class="pcoded-container navbar-wrapper">
            <!-- Cabeçalho (igual ao da página alunos) -->
            <!-- Sidebar (igual ao da página alunos) -->

            <nav class="navbar header-navbar pcoded-header">
                <div class="navbar-wrapper">

                    <div class="navbar-logo">
                        <a class="mobile-menu" id="mobile-collapse" href="#!">
                            <i class="feather icon-menu"></i>
                        </a>
                        <a href="dashboard.htm">
                            <img class="img-fluid" src="libraries\assets\images\logo.png" height="50px" width="50px" alt="Theme-Logo"> <span class="font-italic font-weight-bold text-uppercase text-warning text-center">SECRETARIA|Alda Lara</span>
                        </a>
                        <a class="mobile-options">
                            <i class="feather icon-more-horizontal"></i>
                        </a>
                    </div>

                    <div class="navbar-container container-fluid">
                        <ul class="nav-left">
                            <li class="header-search">
                                <div class="main-search morphsearch-search">
                                    <div class="input-group">
                                        <span class="input-group-addon search-close"><i class="feather icon-x"></i></span>
                                        <input type="text" class="form-control">
                                        <span class="input-group-addon search-btn"><i class="feather icon-search"></i></span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <a href="#!" onclick="javascript:toggleFullScreen()">
                                    <i class="feather icon-maximize full-screen"></i>
                                </a>
                            </li>
                        </ul>
                        <ul class="nav-right">
                            <li class="header-notification">
                                <div class="dropdown-primary dropdown">
                                    <div class="dropdown-toggle" data-toggle="dropdown">
                                        <i class="feather icon-bell"></i>
                                        <span class="badge bg-c-pink">5</span>
                                    </div>
                                    <ul class="show-notification notification-view dropdown-menu" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                                        <li>
                                            <h6>Notifications</h6>
                                            <label class="label label-danger">New</label>
                                        </li>
                                        <li>
                                            <div class="media">
                                                <img class="d-flex align-self-center img-radius" src="libraries\assets\images\avatar-4.jpg" alt="Generic placeholder image">
                                                <div class="media-body">
                                                    <h5 class="notification-user">Flavio Garcia</h5>
                                                    <p class="notification-msg">Lorem ipsum dolor sit amet, consectetuer elit.</p>
                                                    <span class="notification-time">30 minutes ago</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="media">
                                                <img class="d-flex align-self-center img-radius" src="libraries\assets\images\avatar-3.jpg" alt="Generic placeholder image">
                                                <div class="media-body">
                                                    <h5 class="notification-user">Jucelmo Pereira</h5>
                                                    <p class="notification-msg">Lorem ipsum dolor sit amet, consectetuer elit.</p>
                                                    <span class="notification-time">30 minutes ago</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="media">
                                                <img class="d-flex align-self-center img-radius" src="libraries\assets\images\avatar-4.jpg" alt="Generic placeholder image">
                                                <div class="media-body">
                                                    <h5 class="notification-user">Ariel Patricio</h5>
                                                    <p class="notification-msg">Lorem ipsum dolor sit amet, consectetuer elit.</p>
                                                    <span class="notification-time">30 minutes ago</span>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="user-profile header-notification">
                                <div class="dropdown-primary dropdown">
                                    <div class="dropdown-toggle" data-toggle="dropdown">
                                        <img src="libraries\assets\images\avatar-4.jpg" class="img-radius" alt="User-Profile-Image">
                                        <span>Flavio Garcia</span>
                                        <i class="feather icon-chevron-down"></i>
                                    </div>
                                    <ul class="show-notification profile-notification dropdown-menu" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                                        <li>
                                            <a href="#!">
                                                <i class="feather icon-settings"></i> Settings
                                            </a>
                                        </li>
                                        <li>
                                            <a href="user-profile.htm">
                                                <i class="feather icon-user"></i> Profile
                                            </a>
                                        </li>
                                        <li>
                                            <a href="email-inbox.htm">
                                                <i class="feather icon-mail"></i> My Messages
                                            </a>
                                        </li>
                                        <li>
                                            <a href="auth-lock-screen.htm">
                                                <i class="feather icon-lock"></i> Lock Screen
                                            </a>
                                        </li>
                                        <li>
                                            <a href="login.htm">
                                                <i class="feather icon-log-out"></i> Logout
                                            </a>
                                        </li>
                                    </ul>

                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!--sidebar-->
            <div class="pcoded-main-container">
                <div class="pcoded-wrapper">
                    <nav class="pcoded-navbar">
                        <div class="pcoded-inner-navbar main-menu">
                            <div class="pcoded-navigatio-lavel">Navegacao</div>
                            <ul class="pcoded-item pcoded-left-item">
                                <li class="pcoded-hasmenu active pcoded-trigger">
                                    <a href="javascript:void(0)">
                                        <span class="pcoded-micon"><i class="feather icon-home"></i></span>
                                        <span class="pcoded-mtext">Dashboard</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="javascript:void(0)">
                                        <span class="pcoded-micon"><i class="feather icon-user-plus"></i></span>
                                        <span class="pcoded-mtext">Matrículas</span>
                                    </a>
                                    <ul class="pcoded-submenu">
                                        <li class=" ">
                                            <a href="#">
                                                <span class="pcoded-mtext">Matrículas</span>
                                            </a>
                                        </li>
                                        <li class=" ">
                                            <a href="#">
                                                <span class="pcoded-mtext">Transferências</span>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/alunos.php">
                                        <span class="pcoded-micon"><i class="feather icon-users"></i></span>
                                        <span class="pcoded-mtext">Gerenciar Alunos</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/turmas.php">
                                        <span class="pcoded-micon"><i class="feather icon-layers"></i></span>
                                        <span class="pcoded-mtext">Gerenciar Turmas</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/documentos.php">
                                        <span class="pcoded-micon"><i class="feather icon-file-text"></i></span>
                                        <span class="pcoded-mtext">Documentos Admins.</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/comunicados.php">
                                        <span class="pcoded-micon"><i class="feather icon-mail"></i></span>
                                        <span class="pcoded-mtext">Envio de Comunicados</span>
                                    </a>
                                </li>
                                <li class="pcoded-hasmenu">
                                    <a href="/secretaria/relatorios.php">
                                        <span class="pcoded-micon"><i class="feather icon-bar-chart"></i></span>
                                        <span class="pcoded-mtext">Relatórios Acadêmicos</span>
                                    </a>
                                </li>
                                
                            </ul>
                        </div>
                    </nav>
                    <!-- Conteúdo Principal -->
                    <div class="pcoded-content">
                        <div class="pcoded-inner-content">
                            <div class="main-body">
                                <div class="page-wrapper">
                                    <div class="page-body">
                                        <div class="row">
                                            <div class="col-12 mt-4">
                                                <!-- Filtros -->
                                                <div class="card card-matricula mb-3">
                                                    <div class="card-header">
                                                        <h5>Filtrar Matrículas</h5>
                                                    </div>
                                                    <div class="card-body">
                                                        <form id="formFiltros" method="GET" action="">
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="status">Status</label>
                                                                        <select class="form-control" id="status" name="status">
                                                                            <option value="pendente" <?= $status == 'pendente' ? 'selected' : '' ?>>Pendentes</option>
                                                                            <option value="aprovada" <?= $status == 'aprovada' ? 'selected' : '' ?>>Aprovadas</option>
                                                                            <option value="rejeitada" <?= $status == 'rejeitada' ? 'selected' : '' ?>>Rejeitadas</option>
                                                                            <option value="todos" <?= $status == 'todos' ? 'selected' : '' ?>>Todos</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="id_curso">Curso</label>
                                                                        <select class="form-control" id="id_curso" name="id_curso">
                                                                            <option value="">Todos os cursos</option>
                                                                            <?php foreach ($cursos as $curso): ?>
                                                                            <option value="<?= $curso['id_curso'] ?>" <?= $id_curso == $curso['id_curso'] ? 'selected' : '' ?>>
                                                                                <?= htmlspecialchars($curso['nome']) ?>
                                                                            </option>
                                                                            <?php endforeach; ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="ano_letivo">Ano Letivo</label>
                                                                        <select class="form-control" id="ano_letivo" name="ano_letivo">
                                                                            <option value="<?= date('Y')-1 ?>"><?= date('Y')-1 ?></option>
                                                                            <option value="<?= date('Y') ?>" selected><?= date('Y') ?></option>
                                                                            <option value="<?= date('Y')+1 ?>"><?= date('Y')+1 ?></option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3 d-flex align-items-end">
                                                                    <button type="submit" class="btn btn-primary btn-block">
                                                                        <i class="feather icon-filter"></i> Filtrar
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>

                                                <!-- Tabela de Matrículas -->
                                                <div class="card card-matricula">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <h5 class="mb-0">Gestão de Matrículas</h5>
                                                        <div>
                                                            <button class="btn btn-primary" data-toggle="modal" data-target="#modalNovaMatricula">
                                                                <i class="feather icon-plus"></i> Nova Matrícula
                                                            </button>
                                                            <button class="btn btn-success" data-toggle="modal" data-target="#modalTransferencia">
                                                                <i class="feather icon-repeat"></i> Transferência
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="table-responsive">
                                                            <table class="table table-hover">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Aluno</th>
                                                                        <th>BI</th>
                                                                        <th>Curso</th>
                                                                        <th>Turma</th>
                                                                        <th>Tipo</th>
                                                                        <th>Data</th>
                                                                        <th>Status</th>
                                                                        <th>Ações</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <?php if (empty($matriculas)): ?>
                                                                    <tr>
                                                                        <td colspan="8" class="text-center">Nenhuma matrícula encontrada com os filtros selecionados</td>
                                                                    </tr>
                                                                    <?php else: ?>
                                                                    <?php foreach ($matriculas as $matricula): ?>
                                                                    <tr>
                                                                        <td><?= htmlspecialchars($matricula['nome']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['bi_numero']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['curso'] ?? 'N/D') ?></td>
                                                                        <td><?= htmlspecialchars($matricula['turma'] ?? 'N/D') ?></td>
                                                                        <td>
                                                                            <?= $matricula['tipo_matricula'] == 'regular' ? 'Regular' : 'Transferência' ?>
                                                                        </td>
                                                                        <td><?= date('d/m/Y', strtotime($matricula['data_matricula'])) ?></td>
                                                                        <td>
                                                                            <?php 
                                                                            $badge_class = '';
                                                                            if ($matricula['status_matricula'] == 'pendente') $badge_class = 'badge-pendente';
                                                                            elseif ($matricula['status_matricula'] == 'aprovada') $badge_class = 'badge-aprovada';
                                                                            else $badge_class = 'badge-rejeitada';
                                                                            ?>
                                                                            <span class="badge <?= $badge_class ?>">
                                                                                <?= ucfirst($matricula['status_matricula']) ?>
                                                                            </span>
                                                                        </td>
                                                                        <td>
                                                                            <div class="btn-group btn-group-sm">
                                                                                <?php if ($matricula['status_matricula'] == 'pendente'): ?>
                                                                                <button class="btn btn-success btn-action" onclick="aprovarMatricula(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-check"></i>
                                                                                </button>
                                                                                <button class="btn btn-danger btn-action" onclick="rejeitarMatricula(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-x"></i>
                                                                                </button>
                                                                                <?php endif; ?>
                                                                                <button class="btn btn-info btn-action" onclick="editarMatricula(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-edit"></i>
                                                                                </button>
                                                                                <button class="btn btn-secondary btn-action" onclick="emitirComprovante(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-printer"></i>
                                                                                </button>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    <?php endforeach; ?>
                                                                    <?php endif; ?>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Modal Histórico do Aluno -->
                                                <div class="modal fade" id="modalHistorico" tabindex="-1" role="dialog" aria-labelledby="modalHistoricoLabel" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header bg-primary text-white">
                                                                <h5 class="modal-title" id="modalHistoricoLabel">Histórico Escolar</h5>
                                                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="row mb-3">
                                                                    <div class="col-md-6">
                                                                        <h6><strong>Aluno:</strong> <span id="nomeAlunoHistorico"></span></h6>
                                                                        <h6><strong>BI:</strong> <span id="biAlunoHistorico"></span></h6>
                                                                    </div>
                                                                    <div class="col-md-6 text-right">
                                                                        <button class="btn btn-sm btn-success" onclick="imprimirHistorico()">
                                                                            <i class="feather icon-printer"></i> Imprimir Histórico
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="table-responsive">
                                                                    <table class="table table-bordered" id="tabelaHistorico">
                                                                        <thead class="thead-light">
                                                                            <tr>
                                                                                <th>Ano Letivo</th>
                                                                                <th>Curso</th>
                                                                                <th>Turma</th>
                                                                                <th>Status</th>
                                                                                <th>Tipo</th>
                                                                                <th>Data</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="corpoHistorico">
                                                                            <!-- Dados serão carregados via AJAX -->
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                                
                                                                <div class="mt-3" id="documentosAluno">
                                                                    <h5>Documentos Associados</h5>
                                                                    <div class="list-group" id="listaDocumentos">
                                                                        <!-- Documentos serão carregados via AJAX -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Modal Relatórios -->
                                                <div class="modal fade" id="modalRelatorios" tabindex="-1" role="dialog" aria-labelledby="modalRelatoriosLabel" aria-hidden="true">
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header bg-info text-white">
                                                                <h5 class="modal-title" id="modalRelatoriosLabel">Gerar Relatório</h5>
                                                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="formRelatorio" action="gerar_relatorio_matriculas.php" method="GET" target="_blank">
                                                                    <div class="form-group">
                                                                        <label for="tipoRelatorio">Tipo de Relatório</label>
                                                                        <select class="form-control" id="tipoRelatorio" name="tipo" required>
                                                                            <option value="matriculas_por_curso">Matrículas por Curso</option>
                                                                            <option value="matriculas_por_periodo">Matrículas por Período</option>
                                                                            <option value="transferencias">Transferências</option>
                                                                            <option value="status_matriculas">Status das Matrículas</option>
                                                                        </select>
                                                                    </div>
                                                                    
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="dataInicio">Data Início</label>
                                                                                <input type="date" class="form-control" id="dataInicio" name="data_inicio">
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label for="dataFim">Data Fim</label>
                                                                                <input type="date" class="form-control" id="dataFim" name="data_fim">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="form-group">
                                                                        <label for="formatoRelatorio">Formato</label>
                                                                        <select class="form-control" id="formatoRelatorio" name="formato" required>
                                                                            <option value="pdf">PDF</option>
                                                                            <option value="excel">Excel</option>
                                                                        </select>
                                                                    </div>
                                                                    
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                                                                        <button type="submit" class="btn btn-info">Gerar Relatório</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Matrícula -->
    <div class="modal fade" id="modalNovaMatricula" tabindex="-1" role="dialog" aria-labelledby="modalNovaMatriculaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalNovaMatriculaLabel">Nova Matrícula</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formMatricula" method="POST" action="salvar_matricula.php">
                        <input type="hidden" name="tipo_matricula" value="regular">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="id_aluno">Aluno *</label>
                                    <select class="form-control" id="id_aluno" name="id_aluno" required>
                                        <option value="">Selecione um aluno</option>
                                        <?php foreach ($alunos_nao_matriculados as $aluno): ?>
                                        <option value="<?= $aluno['id_aluno'] ?>"><?= htmlspecialchars($aluno['nome']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="ano_letivo_matricula">Ano Letivo *</label>
                                    <select class="form-control" id="ano_letivo_matricula" name="ano_letivo" required>
                                        <option value="<?= date('Y') ?>" selected><?= date('Y') ?></option>
                                        <option value="<?= date('Y')+1 ?>"><?= date('Y')+1 ?></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="curso_matricula">Curso *</label>
                                    <select class="form-control" id="curso_matricula" name="id_curso" required>
                                        <option value="">Selecione um curso</option>
                                        <?php foreach ($cursos as $curso): ?>
                                        <option value="<?= $curso['id_curso'] ?>"><?= htmlspecialchars($curso['nome']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="turma_matricula">Turma</label>
                                    <select class="form-control" id="turma_matricula" name="id_turma">
                                        <option value="">Selecione um curso primeiro</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar Matrícula</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Transferência -->
    <div class="modal fade" id="modalTransferencia" tabindex="-1" role="dialog" aria-labelledby="modalTransferenciaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalTransferenciaLabel">Registrar Transferência</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formTransferencia" method="POST" action="salvar_matricula.php">
                        <input type="hidden" name="tipo_matricula" value="transferencia">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="aluno_transferencia">Aluno *</label>
                                    <select class="form-control" id="aluno_transferencia" name="id_aluno" required>
                                        <option value="">Selecione um aluno</option>
                                        <!-- Lista de alunos já matriculados -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="ano_letivo_transferencia">Ano Letivo *</label>
                                    <select class="form-control" id="ano_letivo_transferencia" name="ano_letivo" required>
                                        <option value="<?= date('Y') ?>" selected><?= date('Y') ?></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="curso_origem">Curso de Origem</label>
                                    <input type="text" class="form-control" id="curso_origem" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="turma_origem">Turma de Origem</label>
                                    <input type="text" class="form-control" id="turma_origem" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="curso_destino">Novo Curso *</label>
                                    <select class="form-control" id="curso_destino" name="id_curso" required>
                                        <option value="">Selecione o novo curso</option>
                                        <?php foreach ($cursos as $curso): ?>
                                        <option value="<?= $curso['id_curso'] ?>"><?= htmlspecialchars($curso['nome']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="turma_destino">Nova Turma</label>
                                    <select class="form-control" id="turma_destino" name="id_turma">
                                        <option value="">Selecione um curso primeiro</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="motivo_transferencia">Motivo da Transferência *</label>
                            <textarea class="form-control" id="motivo_transferencia" name="observacoes" rows="3" required></textarea>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-info">Registrar Transferência</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../libraries/bower_components/jquery/js/jquery.min.js"></script>
    <script src="../libraries/bower_components/jquery-ui/js/jquery-ui.min.js"></script>
    <script src="../libraries/bower_components/popper.js/js/popper.min.js"></script>
    <script src="../libraries/bower_components/bootstrap/js/bootstrap.min.js"></script>
    <script src="../libraries/bower_components/jquery-slimscroll/js/jquery.slimscroll.js"></script>
    <script src="../libraries/bower_components/modernizr/js/modernizr.js"></script>
    <script src="../libraries/assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="../libraries/assets/js/pcoded.min.js"></script>
    <script src="../libraries/assets/js/vartical-layout.min.js"></script>
    <script src="../libraries/assets/js/script.min.js"></script>

    <!-- Warning Section Ends -->
    <!-- Required Jquery -->
    <script data-cfasync="false" src="..\..\..\cdn-cgi\scripts\5c5dd728\cloudflare-static\email-decode.min.js"></script><script type="text/javascript" src="libraries\bower_components\jquery\js\jquery.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\jquery-ui\js\jquery-ui.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\popper.js\js\popper.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\bootstrap\js\bootstrap.min.js"></script>
    <!-- jquery slimscroll js -->
    <script type="text/javascript" src="libraries\bower_components\jquery-slimscroll\js\jquery.slimscroll.js"></script>
    <!-- modernizr js -->
    <script type="text/javascript" src="libraries\bower_components\modernizr\js\modernizr.js"></script>
    <!-- Chart js -->
    <script type="text/javascript" src="libraries\bower_components\chart.js\js\Chart.js"></script>
    <!-- amchart js -->
    <script src="libraries\assets\pages\widget\amchart\amcharts.js"></script>
    <script src="libraries\assets\pages\widget\amchart\serial.js"></script>
    <script src="libraries\assets\pages\widget\amchart\light.js"></script>
    <script src="libraries\assets\js\jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="libraries\assets\js\SmoothScroll.js"></script>
    <script src="libraries\assets\js\pcoded.min.js"></script>
    <!-- custom js -->
    <script src="libraries\assets\js\vartical-layout.min.js"></script>
    <script type="text/javascript" src="libraries\assets\js\script.min.js"></script>

    <script>
        // Funções do Sistema
        function carregarTurmas(id_curso, elemento) {
            if(id_curso) {
                $.ajax({
                    url: 'getTurma.php',
                    method: 'GET',
                    data: { id_curso: id_curso },
                    success: function(response) {
                        $(elemento).html(response);
                    },
                    error: function() {
                        $(elemento).html('<option value="">Erro ao carregar turmas</option>');
                    }
                });
            } else {
                $(elemento).html('<option value="">Selecione um curso primeiro</option>');
            }
        }
        
        function aprovarMatricula(id) {
            if(confirm('Deseja aprovar esta matrícula?')) {
                $.ajax({
                    url: 'alterar_status_matricula.php',
                    method: 'POST',
                    data: { id: id, status: 'aprovada' },
                    dataType: 'json',
                    success: function(response) {
                        if(response.success) {
                            alert('Matrícula aprovada com sucesso');
                            location.reload();
                        } else {
                            alert('Erro: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('Erro na comunicação com o servidor');
                    }
                });
            }
        }
        
        function rejeitarMatricula(id) {
            if(confirm('Deseja rejeitar esta matrícula?')) {
                $.ajax({
                    url: 'alterar_status_matricula.php',
                    method: 'POST',
                    data: { id: id, status: 'rejeitada' },
                    dataType: 'json',
                    success: function(response) {
                        if(response.success) {
                            alert('Matrícula rejeitada com sucesso');
                            location.reload();
                        } else {
                            alert('Erro: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('Erro na comunicação com o servidor');
                    }
                });
            }
        }
        
        function editarMatricula(id) {
            // Implementar lógica para edição
            alert('Editar matrícula ID: ' + id);
        }
        
        function emitirComprovante(id) {
            window.open('comprovante_matricula.php?id=' + id, '_blank');
        }
        
        // Carregar turmas quando um curso é selecionado
        $(document).ready(function() {
            $('#curso_matricula').change(function() {
                carregarTurmas($(this).val(), '#turma_matricula');
            });
            
            $('#curso_destino').change(function() {
                carregarTurmas($(this).val(), '#turma_destino');
            });
            
            // Carregar alunos matriculados para transferência
            $.ajax({
                url: 'get_alunos_matriculados.php',
                method: 'GET',
                data: { ano_letivo: $('#ano_letivo_transferencia').val() },
                success: function(response) {
                    $('#aluno_transferencia').html(response);
                }
            });
            
            // Carregar dados do aluno selecionado para transferência
            $('#aluno_transferencia').change(function() {
                const id_aluno = $(this).val();
                if(id_aluno) {
                    $.ajax({
                        url: 'get_dados_aluno.php',
                        method: 'GET',
                        data: { id_aluno: id_aluno },
                        dataType: 'json',
                        success: function(aluno) {
                            $('#curso_origem').val(aluno.curso || 'N/D');
                            $('#turma_origem').val(aluno.turma || 'N/D');
                        }
                    });
                }
            });
        });
        </script>

        <script>
            // Visualizar histórico completo do aluno
            function visualizarHistorico(id_aluno, nome, bi) {
                $('#nomeAlunoHistorico').text(nome);
                $('#biAlunoHistorico').text(bi);
                
                $.ajax({
                    url: 'get_historico_aluno.php',
                    method: 'GET',
                    data: { id_aluno: id_aluno },
                    dataType: 'json',
                    success: function(response) {
                        let html = '';
                        response.matriculas.forEach(function(matricula) {
                            html += `
                            <tr>
                                <td>${matricula.ano_letivo}</td>
                                <td>${matricula.curso || 'N/D'}</td>
                                <td>${matricula.turma || 'N/D'}</td>
                                <td>
                                    <span class="badge ${matricula.status === 'aprovada' ? 'badge-success' : 
                                                    matricula.status === 'rejeitada' ? 'badge-danger' : 'badge-warning'}">
                                        ${matricula.status}
                                    </span>
                                </td>
                                <td>${matricula.tipo === 'regular' ? 'Regular' : 'Transferência'}</td>
                                <td>${matricula.data}</td>
                            </tr>
                            `;
                        });
                        $('#corpoHistorico').html(html);
                        
                        // Carregar documentos
                        let docsHtml = '';
                        if (response.documentos && response.documentos.length > 0) {
                            response.documentos.forEach(function(doc) {
                                docsHtml += `
                                <a href="../documentos/${doc.arquivo}" target="_blank" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">${doc.tipo}</h6>
                                        <small>${doc.data}</small>
                                    </div>
                                    <p class="mb-1">${doc.descricao || 'Sem descrição'}</p>
                                </a>
                                `;
                            });
                        } else {
                            docsHtml = '<div class="alert alert-info">Nenhum documento associado</div>';
                        }
                        $('#listaDocumentos').html(docsHtml);
                        
                        $('#modalHistorico').modal('show');
                    },
                    error: function() {
                        alert('Erro ao carregar histórico do aluno');
                    }
                });
            }

            // Imprimir histórico escolar
            function imprimirHistorico() {
                const nome = $('#nomeAlunoHistorico').text();
                const bi = $('#biAlunoHistorico').text();
                
                window.open(`historico_escolar.php?nome=${encodeURIComponent(nome)}&bi=${bi}`, '_blank');
            }

            // Gerar relatório de matrículas
            function gerarRelatorio() {
                $('#modalRelatorios').modal('show');
            }

            // Atualizar datas padrão no modal de relatórios
            $(document).ready(function() {
                const hoje = new Date();
                const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                
                $('#dataInicio').val(primeiroDiaMes.toISOString().split('T')[0]);
                $('#dataFim').val(hoje.toISOString().split('T')[0]);
                
                // Atualizar campos conforme tipo de relatório
                $('#tipoRelatorio').change(function() {
                    const tipo = $(this).val();
                    if (tipo === 'matriculas_por_periodo' || tipo === 'transferencias') {
                        $('#dataInicio, #dataFim').prop('required', true);
                    } else {
                        $('#dataInicio, #dataFim').prop('required', false);
                    }
                });
            });
    </script>
</body>
</html>


-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Apr 06, 2025 at 06:26 PM
-- Server version: 10.4.32-MariaDB
-- PHP Version: 8.2.12

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `escoladb`
--

-- --------------------------------------------------------

--
-- Table structure for table `aluno`
--

CREATE TABLE `aluno` (
  `id_aluno` int(11) NOT NULL,
  `data_nascimento` date NOT NULL,
  `genero` varchar(10) NOT NULL,
  `naturalidade` varchar(100) NOT NULL,
  `nacionalidade` varchar(100) NOT NULL,
  `municipio` varchar(100) NOT NULL,
  `nome_encarregado` varchar(100) NOT NULL,
  `contacto_encarregado` varchar(20) NOT NULL,
  `numero_matricula` varchar(20) NOT NULL,
  `ano_letivo` year(4) NOT NULL,
  `usuario_id_usuario` int(11) NOT NULL,
  `turma_id_turma` int(11) NOT NULL,
  `curso_id_curso` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `aluno`
--

INSERT INTO `aluno` (`id_aluno`, `data_nascimento`, `genero`, `naturalidade`, `nacionalidade`, `municipio`, `nome_encarregado`, `contacto_encarregado`, `numero_matricula`, `ano_letivo`, `usuario_id_usuario`, `turma_id_turma`, `curso_id_curso`) VALUES
(1, '0000-00-00', '', '', '', '', '', '', 'AL-2025-4002', '2025', 1, 1, 1);

-- --------------------------------------------------------

--
-- Table structure for table `comunicado`
--

CREATE TABLE `comunicado` (
  `id_comunicado` int(11) NOT NULL,
  `titulo` varchar(255) NOT NULL,
  `mensagem` text NOT NULL,
  `data` timestamp NOT NULL DEFAULT current_timestamp(),
  `usuario_id_usuario` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `coordenador`
--

CREATE TABLE `coordenador` (
  `id_coordenador` int(11) NOT NULL,
  `usuario_id_usuario` int(11) NOT NULL,
  `curso_id_curso` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `coordenador`
--

INSERT INTO `coordenador` (`id_coordenador`, `usuario_id_usuario`, `curso_id_curso`) VALUES
(1, 4, 1);

-- --------------------------------------------------------

--
-- Table structure for table `cronograma_aula`
--

CREATE TABLE `cronograma_aula` (
  `id_cronograma_aula` int(11) NOT NULL,
  `dia_semana` enum('segunda','terca','quarta','quinta','sexta','sabado') NOT NULL,
  `horario_inicio` time NOT NULL,
  `horario_fim` time NOT NULL,
  `sala` varchar(10) NOT NULL,
  `id_professor` int(11) NOT NULL,
  `turma_id_turma` int(11) NOT NULL,
  `id_disciplina` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `curso`
--

CREATE TABLE `curso` (
  `id_curso` int(11) NOT NULL,
  `nome` varchar(100) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `curso`
--

INSERT INTO `curso` (`id_curso`, `nome`) VALUES
(1, 'Tecnico de Informatica'),
(2, 'desenhador projetista'),
(3, 'eletricidade ');

-- --------------------------------------------------------

--
-- Table structure for table `disciplina`
--

CREATE TABLE `disciplina` (
  `id_disciplina` int(11) NOT NULL,
  `nome` varchar(50) NOT NULL,
  `curso_id_curso` int(11) NOT NULL,
  `professor_id_professor` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `disciplina`
--

INSERT INTO `disciplina` (`id_disciplina`, `nome`, `curso_id_curso`, `professor_id_professor`) VALUES
(1, 'Matematica', 1, NULL),
(6, 'TLP', 1, 2),
(7, 'Electrotecnia', 1, NULL),
(8, 'Lingua Portuguesa', 1, NULL);

-- --------------------------------------------------------

--
-- Table structure for table `frequencia_aluno`
--

CREATE TABLE `frequencia_aluno` (
  `id_frequencia_aluno` int(11) NOT NULL,
  `data_aula` date NOT NULL,
  `presenca` enum('presente','ausente','justificado') NOT NULL DEFAULT 'ausente',
  `aluno_id_aluno` int(11) NOT NULL,
  `disciplina_id_disciplina` int(11) NOT NULL,
  `turma_id_turma` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `historico_professor`
--

CREATE TABLE `historico_professor` (
  `id_historico` int(11) NOT NULL,
  `data_inicio` date NOT NULL,
  `data_fim` date DEFAULT NULL,
  `descricao` text NOT NULL,
  `professor_id_professor` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `materiais_apoio`
--

CREATE TABLE `materiais_apoio` (
  `id_material` int(11) NOT NULL,
  `nome` varchar(255) NOT NULL,
  `descricao` text NOT NULL,
  `caminho_arquivo` varchar(255) NOT NULL,
  `id_disciplina` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `materiais_apoio_tem_usuario`
--

CREATE TABLE `materiais_apoio_tem_usuario` (
  `materiais_apoio_id_material` int(11) NOT NULL,
  `usuario_id_usuario` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `matricula`
--

CREATE TABLE `matricula` (
  `id_matricula` int(11) NOT NULL,
  `ano_letivo` year(4) NOT NULL,
  `classe` varchar(10) NOT NULL,
  `turno` varchar(20) NOT NULL,
  `numero_matricula` varchar(20) NOT NULL,
  `data_matricula` date NOT NULL,
  `turma_id_turma` int(11) NOT NULL,
  `aluno_id_aluno` int(11) NOT NULL,
  `curso_id_curso` int(11) NOT NULL,
  `status_matricula` enum('ativa','trancada','cancelada') NOT NULL DEFAULT 'ativa',
  `comprovativo_pagamento` varchar(100) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `matricula`
--

INSERT INTO `matricula` (`id_matricula`, `ano_letivo`, `classe`, `turno`, `numero_matricula`, `data_matricula`, `turma_id_turma`, `aluno_id_aluno`, `curso_id_curso`, `status_matricula`, `comprovativo_pagamento`) VALUES
(1, '2025', '', '', '', '2025-04-04', 7, 1, 2, 'ativa', '');

-- --------------------------------------------------------

--
-- Table structure for table `nota`
--

CREATE TABLE `nota` (
  `id_nota` int(11) NOT NULL,
  `nota` decimal(5,2) NOT NULL,
  `data` date NOT NULL,
  `aluno_id_aluno` int(11) NOT NULL,
  `disciplina_id_disciplina` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `password_reset`
--

CREATE TABLE `password_reset` (
  `id` int(11) NOT NULL,
  `email` varchar(255) NOT NULL,
  `token` varchar(255) NOT NULL,
  `expira_em` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `professor`
--

CREATE TABLE `professor` (
  `id_professor` int(11) NOT NULL,
  `usuario_id_usuario` int(11) NOT NULL,
  `curso_id_curso` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `professor`
--

INSERT INTO `professor` (`id_professor`, `usuario_id_usuario`, `curso_id_curso`) VALUES
(1, 2, 1),
(2, 3, 1);

-- --------------------------------------------------------

--
-- Table structure for table `professor_tem_turma`
--

CREATE TABLE `professor_tem_turma` (
  `professor_id_professor` int(11) NOT NULL,
  `turma_id_turma` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `secretaria`
--

CREATE TABLE `secretaria` (
  `id_secretaria` int(11) NOT NULL,
  `setor` varchar(50) NOT NULL,
  `pode_registrar` tinyint(1) NOT NULL DEFAULT 0,
  `usuario_id_usuario` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `secretaria`
--

INSERT INTO `secretaria` (`id_secretaria`, `setor`, `pode_registrar`, `usuario_id_usuario`) VALUES
(1, 'Administrativo', 1, 8),
(3, 'Administrativo', 0, 9);

-- --------------------------------------------------------

--
-- Table structure for table `turma`
--

CREATE TABLE `turma` (
  `id_turma` int(11) NOT NULL,
  `nome` varchar(50) NOT NULL,
  `curso_id_curso` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `turma`
--

INSERT INTO `turma` (`id_turma`, `nome`, `curso_id_curso`) VALUES
(1, 'I13AT', 1),
(7, 'C10AM', 2),
(8, 'E10AM', 3);

-- --------------------------------------------------------

--
-- Table structure for table `usuario`
--

CREATE TABLE `usuario` (
  `id_usuario` int(11) NOT NULL,
  `nome` varchar(100) NOT NULL,
  `email` varchar(100) NOT NULL,
  `senha` varchar(255) NOT NULL,
  `bi_numero` varchar(14) NOT NULL,
  `tipo` enum('diretor_geral','diretor_pedagogico','coordenador','professor','aluno','secretaria') NOT NULL,
  `status` enum('ativo','inativo') NOT NULL DEFAULT 'ativo',
  `foto_perfil` varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

--
-- Dumping data for table `usuario`
--

INSERT INTO `usuario` (`id_usuario`, `nome`, `email`, `senha`, `bi_numero`, `tipo`, `status`, `foto_perfil`) VALUES
(1, 'Flavio Pinto Garcia', 'flaviofuxi86@gmail.com', 'senha_temp', '009097235LA046', 'aluno', 'ativo', NULL),
(3, 'Flavio', 'flaviofuxe86@gmail.com', '$2y$10$zqGQ2i3HS1q6sgo6V4jhTuKekEIEhNgUJDPcqGK8Vp3BnTvvIGRLy', '005097235LA046', 'professor', 'ativo', NULL),
(4, 'flavio', 'kunai86@gmail.com', '$2y$10$4PGGIHAn.aEV5gTmO14yCukzyj7KwvZiD.OjEd7gDDX0hVa6208wu', '009097235LA044', 'coordenador', 'ativo', NULL),
(5, 'Garcia', 'flaviofuxe@gmail.com', '$2y$10$6dLGw4uZ/GUtCzUF1AaeG.BshFoi5Bxf5O5rObuPbW.kLShfbSHuC', '005097235LA049', 'diretor_geral', 'ativo', NULL),
(6, 'Pinto', 'flaviofux@gmail.com', '$2y$10$R12Y7p4vBXKP5NdsxaLKQOjCOUgPi0ad9E6POBru0UbUboywExlzC', '009097235LA046', 'diretor_pedagogico', 'ativo', NULL),
(9, 'Secretaria Padrão', 'secretaria@gmail.com', '$2y$10$1M7SbPlAk4Zm64m2jG4vPOZcDRwHiidDB.Forp/kkyRJhXmOJ7cai', '123456789LA123', 'secretaria', 'ativo', NULL);

--
-- Indexes for dumped tables
--

--
-- Indexes for table `aluno`
--
ALTER TABLE `aluno`
  ADD PRIMARY KEY (`id_aluno`),
  ADD KEY `fk_usuario1_idx` (`usuario_id_usuario`),
  ADD KEY `fk_turma1_idx` (`turma_id_turma`),
  ADD KEY `fk_curso1_idx` (`curso_id_curso`);

--
-- Indexes for table `comunicado`
--
ALTER TABLE `comunicado`
  ADD PRIMARY KEY (`id_comunicado`),
  ADD KEY `fk_usuario5_idx` (`usuario_id_usuario`);

--
-- Indexes for table `coordenador`
--
ALTER TABLE `coordenador`
  ADD PRIMARY KEY (`id_coordenador`),
  ADD KEY `fk_usuario2_idx` (`usuario_id_usuario`),
  ADD KEY `fk_curso2_idx` (`curso_id_curso`);

--
-- Indexes for table `cronograma_aula`
--
ALTER TABLE `cronograma_aula`
  ADD PRIMARY KEY (`id_cronograma_aula`),
  ADD KEY `fk_professor3_idx` (`id_professor`),
  ADD KEY `fk_turma7_idx` (`turma_id_turma`),
  ADD KEY `fk_disciplina5_idx` (`id_disciplina`);

--
-- Indexes for table `curso`
--
ALTER TABLE `curso`
  ADD PRIMARY KEY (`id_curso`);

--
-- Indexes for table `disciplina`
--
ALTER TABLE `disciplina`
  ADD PRIMARY KEY (`id_disciplina`,`curso_id_curso`),
  ADD UNIQUE KEY `id_disciplina_UNIQUE` (`id_disciplina`),
  ADD KEY `fk_curso5_idx` (`curso_id_curso`),
  ADD KEY `fk_professor5_idx` (`professor_id_professor`);

--
-- Indexes for table `frequencia_aluno`
--
ALTER TABLE `frequencia_aluno`
  ADD PRIMARY KEY (`id_frequencia_aluno`),
  ADD KEY `fk_aluno2_idx` (`aluno_id_aluno`),
  ADD KEY `fk_disciplina4_idx` (`disciplina_id_disciplina`),
  ADD KEY `fk_turma4_idx` (`turma_id_turma`);

--
-- Indexes for table `historico_professor`
--
ALTER TABLE `historico_professor`
  ADD PRIMARY KEY (`id_historico`),
  ADD KEY `fk_professor2_idx` (`professor_id_professor`);

--
-- Indexes for table `materiais_apoio`
--
ALTER TABLE `materiais_apoio`
  ADD PRIMARY KEY (`id_material`),
  ADD KEY `fk_disciplina2_idx` (`id_disciplina`);

--
-- Indexes for table `materiais_apoio_tem_usuario`
--
ALTER TABLE `materiais_apoio_tem_usuario`
  ADD PRIMARY KEY (`materiais_apoio_id_material`,`usuario_id_usuario`),
  ADD KEY `fk_materiais_apoio1_idx` (`materiais_apoio_id_material`),
  ADD KEY `fk_usuario6_idx` (`usuario_id_usuario`);

--
-- Indexes for table `matricula`
--
ALTER TABLE `matricula`
  ADD PRIMARY KEY (`id_matricula`),
  ADD UNIQUE KEY `numero_matricula` (`numero_matricula`),
  ADD KEY `fk_turma6_idx` (`turma_id_turma`),
  ADD KEY `fk_aluno3_idx` (`aluno_id_aluno`),
  ADD KEY `fk_curso6_idx` (`curso_id_curso`);

--
-- Indexes for table `nota`
--
ALTER TABLE `nota`
  ADD PRIMARY KEY (`id_nota`),
  ADD KEY `fk_aluno1_idx` (`aluno_id_aluno`),
  ADD KEY `fk_disciplina1_idx` (`disciplina_id_disciplina`);

--
-- Indexes for table `password_reset`
--
ALTER TABLE `password_reset`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `professor`
--
ALTER TABLE `professor`
  ADD PRIMARY KEY (`id_professor`),
  ADD KEY `fk_usuario3_idx` (`usuario_id_usuario`),
  ADD KEY `fk_curso3_idx` (`curso_id_curso`);

--
-- Indexes for table `professor_tem_turma`
--
ALTER TABLE `professor_tem_turma`
  ADD PRIMARY KEY (`professor_id_professor`,`turma_id_turma`),
  ADD KEY `idx_turma2` (`turma_id_turma`),
  ADD KEY `idx_professor2` (`professor_id_professor`);

--
-- Indexes for table `secretaria`
--
ALTER TABLE `secretaria`
  ADD PRIMARY KEY (`id_secretaria`),
  ADD KEY `fk_usuario_idx` (`usuario_id_usuario`);

--
-- Indexes for table `turma`
--
ALTER TABLE `turma`
  ADD PRIMARY KEY (`id_turma`),
  ADD KEY `fk_curso4_idx` (`curso_id_curso`);

--
-- Indexes for table `usuario`
--
ALTER TABLE `usuario`
  ADD PRIMARY KEY (`id_usuario`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `aluno`
--
ALTER TABLE `aluno`
  MODIFY `id_aluno` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;

--
-- AUTO_INCREMENT for table `comunicado`
--
ALTER TABLE `comunicado`
  MODIFY `id_comunicado` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `coordenador`
--
ALTER TABLE `coordenador`
  MODIFY `id_coordenador` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;

--
-- AUTO_INCREMENT for table `cronograma_aula`
--
ALTER TABLE `cronograma_aula`
  MODIFY `id_cronograma_aula` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `curso`
--
ALTER TABLE `curso`
  MODIFY `id_curso` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- AUTO_INCREMENT for table `disciplina`
--
ALTER TABLE `disciplina`
  MODIFY `id_disciplina` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=9;

--
-- AUTO_INCREMENT for table `frequencia_aluno`
--
ALTER TABLE `frequencia_aluno`
  MODIFY `id_frequencia_aluno` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `historico_professor`
--
ALTER TABLE `historico_professor`
  MODIFY `id_historico` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `materiais_apoio`
--
ALTER TABLE `materiais_apoio`
  MODIFY `id_material` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `matricula`
--
ALTER TABLE `matricula`
  MODIFY `id_matricula` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;

--
-- AUTO_INCREMENT for table `nota`
--
ALTER TABLE `nota`
  MODIFY `id_nota` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `password_reset`
--
ALTER TABLE `password_reset`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `professor`
--
ALTER TABLE `professor`
  MODIFY `id_professor` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

--
-- AUTO_INCREMENT for table `secretaria`
--
ALTER TABLE `secretaria`
  MODIFY `id_secretaria` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=4;

--
-- AUTO_INCREMENT for table `turma`
--
ALTER TABLE `turma`
  MODIFY `id_turma` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=9;

--
-- AUTO_INCREMENT for table `usuario`
--
ALTER TABLE `usuario`
  MODIFY `id_usuario` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `aluno`
--
ALTER TABLE `aluno`
  ADD CONSTRAINT `fk_curso1` FOREIGN KEY (`curso_id_curso`) REFERENCES `curso` (`id_curso`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT `fk_turma1` FOREIGN KEY (`turma_id_turma`) REFERENCES `turma` (`id_turma`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT `fk_usuario1` FOREIGN KEY (`usuario_id_usuario`) REFERENCES `usuario` (`id_usuario`) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Constraints for table `comunicado`
--
ALTER TABLE `comunicado`
  ADD CONSTRAINT `fk_usuario5` FOREIGN KEY (`usuario_id_usuario`) REFERENCES `usuario` (`id_usuario`) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Constraints for table `coordenador`
--
ALTER TABLE `coordenador`
  ADD CONSTRAINT `fk_curso2` FOREIGN KEY (`curso_id_curso`) REFERENCES `curso` (`id_curso`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT `fk_usuario2` FOREIGN KEY (`usuario_id_usuario`) REFERENCES `usuario` (`id_usuario`) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Constraints for table `cronograma_aula`
--
ALTER TABLE `cronograma_aula`
  ADD CONSTRAINT `fk_disciplina5` FOREIGN KEY (`id_disciplina`) REFERENCES `disciplina` (`id_disciplina`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `fk_professor3` FOREIGN KEY (`id_professor`) REFERENCES `professor` (`id_professor`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `fk_turma7` FOREIGN KEY (`turma_id_turma`) REFERENCES `turma` (`id_turma`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `disciplina`
--
ALTER TABLE `disciplina`
  ADD CONSTRAINT `fk_curso5` FOREIGN KEY (`curso_id_curso`) REFERENCES `curso` (`id_curso`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT `fk_professor5` FOREIGN KEY (`professor_id_professor`) REFERENCES `professor` (`id_professor`) ON DELETE SET NULL ON UPDATE NO ACTION;

--
-- Constraints for table `frequencia_aluno`
--
ALTER TABLE `frequencia_aluno`
  ADD CONSTRAINT `fk_aluno2` FOREIGN KEY (`aluno_id_aluno`) REFERENCES `aluno` (`id_aluno`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `fk_disciplina4` FOREIGN KEY (`disciplina_id_disciplina`) REFERENCES `disciplina` (`id_disciplina`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `fk_turma4` FOREIGN KEY (`turma_id_turma`) REFERENCES `turma` (`id_turma`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `historico_professor`
--
ALTER TABLE `historico_professor`
  ADD CONSTRAINT `fk_professor2` FOREIGN KEY (`professor_id_professor`) REFERENCES `professor` (`id_professor`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `materiais_apoio`
--
ALTER TABLE `materiais_apoio`
  ADD CONSTRAINT `fk_disciplina2` FOREIGN KEY (`id_disciplina`) REFERENCES `disciplina` (`id_disciplina`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `materiais_apoio_tem_usuario`
--
ALTER TABLE `materiais_apoio_tem_usuario`
  ADD CONSTRAINT `fk_materiais_apoio1` FOREIGN KEY (`materiais_apoio_id_material`) REFERENCES `materiais_apoio` (`id_material`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT `fk_usuario6` FOREIGN KEY (`usuario_id_usuario`) REFERENCES `usuario` (`id_usuario`) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Constraints for table `matricula`
--
ALTER TABLE `matricula`
  ADD CONSTRAINT `fk_aluno3` FOREIGN KEY (`aluno_id_aluno`) REFERENCES `aluno` (`id_aluno`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `fk_curso6` FOREIGN KEY (`curso_id_curso`) REFERENCES `curso` (`id_curso`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `fk_turma6` FOREIGN KEY (`turma_id_turma`) REFERENCES `turma` (`id_turma`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `nota`
--
ALTER TABLE `nota`
  ADD CONSTRAINT `fk_aluno1` FOREIGN KEY (`aluno_id_aluno`) REFERENCES `aluno` (`id_aluno`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `fk_disciplina1` FOREIGN KEY (`disciplina_id_disciplina`) REFERENCES `disciplina` (`id_disciplina`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `professor`
--
ALTER TABLE `professor`
  ADD CONSTRAINT `fk_curso3` FOREIGN KEY (`curso_id_curso`) REFERENCES `curso` (`id_curso`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT `fk_usuario3` FOREIGN KEY (`usuario_id_usuario`) REFERENCES `usuario` (`id_usuario`) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Constraints for table `professor_tem_turma`
--
ALTER TABLE `professor_tem_turma`
  ADD CONSTRAINT `fk_professor_tem_turma_professor` FOREIGN KEY (`professor_id_professor`) REFERENCES `professor` (`id_professor`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  ADD CONSTRAINT `fk_professor_tem_turma_turma` FOREIGN KEY (`turma_id_turma`) REFERENCES `turma` (`id_turma`) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Constraints for table `secretaria`
--
ALTER TABLE `secretaria`
  ADD CONSTRAINT `fk_usuario` FOREIGN KEY (`usuario_id_usuario`) REFERENCES `usuario` (`id_usuario`) ON DELETE NO ACTION ON UPDATE NO ACTION;

--
-- Constraints for table `turma`
--
ALTER TABLE `turma`
  ADD CONSTRAINT `fk_curso4` FOREIGN KEY (`curso_id_curso`) REFERENCES `curso` (`id_curso`) ON DELETE NO ACTION ON UPDATE NO ACTION;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
<?php
#require_once "../auth/permissoes.php";
#verificarPermissao(['secretaria']);
require_once "conexao.php";

// Processar formulário de nova matrícula
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['nova_matricula'])) {
    // Validar e sanitizar dados
    $id_aluno = intval($_POST['id_aluno']);
    $id_curso = intval($_POST['id_curso']);
    $id_turma = intval($_POST['id_turma']);
    $ano_letivo = intval($_POST['ano_letivo']);
    $classe = $_POST['classe'];
    $turno = $_POST['turno'];
    
    // Gerar número de matrícula automático
    $stmt = $conn->prepare("SELECT MAX(id_matricula) as ultimo_id FROM matricula WHERE ano_letivo = ?");
    $stmt->bind_param("i", $ano_letivo);
    $stmt->execute();
    $result = $stmt->get_result();
    $row = $result->fetch_assoc();
    $sequencial = $row['ultimo_id'] ? $row['ultimo_id'] + 1 : 1;
    $numero_matricula = 'AL-' . $ano_letivo . '-' . str_pad($sequencial, 4, '0', STR_PAD_LEFT);
    
    // Inserir matrícula
    $stmt = $conn->prepare("INSERT INTO matricula 
        (ano_letivo, classe, turno, numero_matricula, data_matricula, 
         turma_id_turma, aluno_id_aluno, curso_id_curso, status_matricula, comprovativo_pagamento) 
        VALUES (?, ?, ?, ?, NOW(), ?, ?, ?, 'ativa', 'confirmado')");
    $stmt->bind_param("isssiii", $ano_letivo, $classe, $turno, $numero_matricula, $id_turma, $id_aluno, $id_curso);
    
    if ($stmt->execute()) {
        // Atualizar aluno com turma e curso
        $stmt = $conn->prepare("UPDATE aluno SET turma_id_turma = ?, curso_id_curso = ? WHERE id_aluno = ?");
        $stmt->bind_param("iii", $id_turma, $id_curso, $id_aluno);
        $stmt->execute();
        
        $_SESSION['sucesso'] = "Matrícula registrada com sucesso! Número: $numero_matricula";
    } else {
        $_SESSION['erro'] = "Erro ao registrar matrícula: " . $conn->error;
    }
    
    header('Location: matricula.php');
    exit();
}

// Filtros
$status = isset($_GET['status']) ? $_GET['status'] : 'ativa';
$id_curso = isset($_GET['id_curso']) ? intval($_GET['id_curso']) : null;
$ano_letivo = isset($_GET['ano_letivo']) ? intval($_GET['ano_letivo']) : date('Y');

// Obter matrículas com filtros
$query = "SELECT m.id_matricula, a.id_aluno, u.nome, u.bi_numero, 
          c.nome AS curso, t.nome AS turma, m.data_matricula, 
          m.ano_letivo, m.classe, m.turno, m.numero_matricula,
          m.status_matricula
          FROM matricula m
          JOIN aluno a ON m.aluno_id_aluno = a.id_aluno
          JOIN usuario u ON a.usuario_id_usuario = u.id_usuario
          LEFT JOIN curso c ON m.curso_id_curso = c.id_curso
          LEFT JOIN turma t ON m.turma_id_turma = t.id_turma
          WHERE m.ano_letivo = ?";

$params = [$ano_letivo];
$types = "i";

if ($status != 'todos') {
    $query .= " AND m.status_matricula = ?";
    $params[] = $status;
    $types .= "s";
}

if ($id_curso) {
    $query .= " AND m.curso_id_curso = ?";
    $params[] = $id_curso;
    $types .= "i";
}

$query .= " ORDER BY m.data_matricula DESC";

$stmt = $conn->prepare($query);

if ($params) {
    $stmt->bind_param($types, ...$params);
}

$stmt->execute();
$result = $stmt->get_result();
$matriculas = $result->fetch_all(MYSQLI_ASSOC);

// Obter cursos para filtros
$result_cursos = $conn->query("SELECT id_curso, nome FROM curso ORDER BY nome");
$cursos = $result_cursos->fetch_all(MYSQLI_ASSOC);

// Obter alunos não matriculados no ano letivo
$stmt_nao_matriculados = $conn->prepare("SELECT a.id_aluno, u.nome, u.bi_numero 
                                       FROM aluno a
                                       JOIN usuario u ON a.usuario_id_usuario = u.id_usuario
                                       WHERE a.id_aluno NOT IN 
                                       (SELECT aluno_id_aluno FROM matricula WHERE ano_letivo = ?)");
$stmt_nao_matriculados->bind_param("i", $ano_letivo);
$stmt_nao_matriculados->execute();
$result_nao_matriculados = $stmt_nao_matriculados->get_result();
$alunos_nao_matriculados = $result_nao_matriculados->fetch_all(MYSQLI_ASSOC);

// Obter turmas para select
$turmas = [];
if ($result_turmas = $conn->query("SELECT id_turma, nome, curso_id_curso FROM turma")) {
    $turmas = $result_turmas->fetch_all(MYSQLI_ASSOC);
}
?>

<!DOCTYPE html>
<html lang="pt">
<head>
    <title>SECRETARIA - Gestão de Matrículas | Alda Lara</title>
    <!-- HTML5 Shim and Respond.js IE10 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 10]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="#">
    <meta name="keywords" content="Admin , Responsive, Landing, Bootstrap, App, Template, Mobile, iOS, Android, apple, creative app">
    <meta name="author" content="#">
    <!-- Favicon icon -->
    <link rel="icon" href="libraries\assets\images\favicon.ico" type="image/x-icon">
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet">
    <!-- Required Fremwork -->
    <link rel="stylesheet" type="text/css" href="libraries\bower_components\bootstrap\css\bootstrap.min.css">
    <!-- feather Awesome -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\icon\feather\css\feather.css">
    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\style.css">
    <link rel="stylesheet" type="text/css" href="libraries\assets\css\jquery.mCustomScrollbar.css">
    <style>
        .bg-img {
            background-image: url('../public/img/bg.jpg');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
        }
        
        .card-matricula {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .badge-ativa { background-color: #28a745; color: #fff; }
        .badge-cancelada { background-color: #dc3545; color: #fff; }
        .badge-trancada { background-color: #ffc107; color: #000; }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .numero-matricula {
            font-family: monospace;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .btn-action {
            margin: 2px;
        }
        
        @media (max-width: 768px) {
            .btn-action {
                width: 100%;
            }
        }
    </style>
</head>

<body class="bg-img">
    <!-- Pre-loader -->
    <div class="theme-loader">
        <div class="ball-scale">
            <div class='contain'>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
                <div class="ring"><div class="frame"></div></div>
            </div>
        </div>
    </div>

    <div id="pcoded" class="pcoded">
        <div class="pcoded-overlay-box"></div>
        <div class="pcoded-container navbar-wrapper">
            <?php include 'navbar.php'; ?>
            
            <div class="pcoded-main-container">
                <div class="pcoded-wrapper">
                    <?php include 'sidebar.php'; ?>
                    
                    <div class="pcoded-content">
                        <div class="pcoded-inner-content">
                            <div class="main-body">
                                <div class="page-wrapper">
                                    <div class="page-body">
                                        <!-- Mensagens de feedback -->
                                        <?php if (isset($_SESSION['sucesso'])): ?>
                                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                                            <?= $_SESSION['sucesso'] ?>
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <?php unset($_SESSION['sucesso']); endif; ?>
                                        
                                        <?php if (isset($_SESSION['erro'])): ?>
                                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                            <?= $_SESSION['erro'] ?>
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <?php unset($_SESSION['erro']); endif; ?>
                                        
                                        <div class="row">
                                            <div class="col-12 mt-4">
                                                <!-- Filtros -->
                                                <div class="card card-matricula mb-3">
                                                    <div class="card-header">
                                                        <h5>Filtrar Matrículas</h5>
                                                    </div>
                                                    <div class="card-body">
                                                        <form id="formFiltros" method="GET" action="">
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="status">Status</label>
                                                                        <select class="form-control" id="status" name="status">
                                                                            <option value="ativa" <?= $status == 'ativa' ? 'selected' : '' ?>>Ativas</option>
                                                                            <option value="cancelada" <?= $status == 'cancelada' ? 'selected' : '' ?>>Canceladas</option>
                                                                            <option value="trancada" <?= $status == 'trancada' ? 'selected' : '' ?>>Trancadas</option>
                                                                            <option value="todos" <?= $status == 'todos' ? 'selected' : '' ?>>Todos</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="id_curso">Curso</label>
                                                                        <select class="form-control" id="id_curso" name="id_curso">
                                                                            <option value="">Todos os cursos</option>
                                                                            <?php foreach ($cursos as $curso): ?>
                                                                            <option value="<?= $curso['id_curso'] ?>" <?= $id_curso == $curso['id_curso'] ? 'selected' : '' ?>>
                                                                                <?= htmlspecialchars($curso['nome']) ?>
                                                                            </option>
                                                                            <?php endforeach; ?>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="form-group">
                                                                        <label for="ano_letivo">Ano Letivo</label>
                                                                        <select class="form-control" id="ano_letivo" name="ano_letivo">
                                                                            <option value="<?= date('Y')-1 ?>"><?= date('Y')-1 ?></option>
                                                                            <option value="<?= date('Y') ?>" selected><?= date('Y') ?></option>
                                                                            <option value="<?= date('Y')+1 ?>"><?= date('Y')+1 ?></option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3 d-flex align-items-end">
                                                                    <button type="submit" class="btn btn-primary btn-block">
                                                                        <i class="feather icon-filter"></i> Filtrar
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>

                                                <!-- Tabela de Matrículas -->
                                                <div class="card card-matricula">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <h5 class="mb-0">Gestão de Matrículas - Ano Letivo <?= $ano_letivo ?></h5>
                                                        <div>
                                                            <button class="btn btn-primary" data-toggle="modal" data-target="#modalNovaMatricula">
                                                                <i class="feather icon-plus"></i> Nova Matrícula
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="table-responsive">
                                                            <table class="table table-hover">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Nº Matrícula</th>
                                                                        <th>Aluno</th>
                                                                        <th>BI</th>
                                                                        <th>Curso</th>
                                                                        <th>Turma</th>
                                                                        <th>Classe</th>
                                                                        <th>Turno</th>
                                                                        <th>Data</th>
                                                                        <th>Status</th>
                                                                        <th>Ações</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <?php if (empty($matriculas)): ?>
                                                                    <tr>
                                                                        <td colspan="10" class="text-center">Nenhuma matrícula encontrada com os filtros selecionados</td>
                                                                    </tr>
                                                                    <?php else: ?>
                                                                    <?php foreach ($matriculas as $matricula): ?>
                                                                    <tr>
                                                                        <td class="numero-matricula"><?= htmlspecialchars($matricula['numero_matricula']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['nome']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['bi_numero']) ?></td>
                                                                        <td><?= htmlspecialchars($matricula['curso'] ?? 'N/D') ?></td>
                                                                        <td><?= htmlspecialchars($matricula['turma'] ?? 'N/D') ?></td>
                                                                        <td><?= htmlspecialchars($matricula['classe'] ?? 'N/D') ?></td>
                                                                        <td><?= htmlspecialchars($matricula['turno'] ?? 'N/D') ?></td>
                                                                        <td><?= date('d/m/Y', strtotime($matricula['data_matricula'])) ?></td>
                                                                        <td>
                                                                            <?php 
                                                                            $badge_class = '';
                                                                            if ($matricula['status_matricula'] == 'ativa') $badge_class = 'badge-ativa';
                                                                            elseif ($matricula['status_matricula'] == 'cancelada') $badge_class = 'badge-cancelada';
                                                                            else $badge_class = 'badge-trancada';
                                                                            ?>
                                                                            <span class="badge <?= $badge_class ?>">
                                                                                <?= ucfirst($matricula['status_matricula']) ?>
                                                                            </span>
                                                                        </td>
                                                                        <td>
                                                                            <div class="btn-group btn-group-sm">
                                                                                <button class="btn btn-info btn-action" onclick="editarMatricula(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-edit"></i>
                                                                                </button>
                                                                                <button class="btn btn-secondary btn-action" onclick="emitirComprovante(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-printer"></i>
                                                                                </button>
                                                                                <button class="btn btn-danger btn-action" onclick="cancelarMatricula(<?= $matricula['id_matricula'] ?>)">
                                                                                    <i class="feather icon-x"></i>
                                                                                </button>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    <?php endforeach; ?>
                                                                    <?php endif; ?>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Matrícula -->
    <div class="modal fade" id="modalNovaMatricula" tabindex="-1" role="dialog" aria-labelledby="modalNovaMatriculaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalNovaMatriculaLabel">Nova Matrícula</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formMatricula" method="POST" action="">
                        <input type="hidden" name="nova_matricula" value="1">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="id_aluno">Aluno *</label>
                                    <select class="form-control" id="id_aluno" name="id_aluno" required>
                                        <option value="">Selecione um aluno</option>
                                        <?php foreach ($alunos_nao_matriculados as $aluno): ?>
                                        <option value="<?= $aluno['id_aluno'] ?>">
                                            <?= htmlspecialchars($aluno['nome']) ?> - BI: <?= htmlspecialchars($aluno['bi_numero']) ?>
                                        </option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="ano_letivo_matricula">Ano Letivo *</label>
                                    <select class="form-control" id="ano_letivo_matricula" name="ano_letivo" required>
                                        <option value="<?= date('Y') ?>" selected><?= date('Y') ?></option>
                                        <option value="<?= date('Y')+1 ?>"><?= date('Y')+1 ?></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="curso_matricula">Curso *</label>
                                    <select class="form-control" id="curso_matricula" name="id_curso" required>
                                        <option value="">Selecione um curso</option>
                                        <?php foreach ($cursos as $curso): ?>
                                        <option value="<?= $curso['id_curso'] ?>"><?= htmlspecialchars($curso['nome']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="turma_matricula">Turma *</label>
                                    <select class="form-control" id="turma_matricula" name="id_turma" required>
                                        <option value="">Selecione um curso primeiro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="classe_matricula">Classe *</label>
                                    <select class="form-control" id="classe_matricula" name="classe" required>
                                        <option value="10ª">10ª Classe</option>
                                        <option value="11ª">11ª Classe</option>
                                        <option value="12ª">12ª Classe</option>
                                        <option value="13ª">13ª Classe</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="turno_matricula">Turno *</label>
                                    <select class="form-control" id="turno_matricula" name="turno" required>
                                        <option value="Manhã">Manhã</option>
                                        <option value="Tarde">Tarde</option>
                                        <option value="Noite">Noite</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Pagamento</label>
                                    <div class="form-control bg-success text-white">
                                        <i class="feather icon-check"></i> Confirmado (via Rupe)
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Registrar Matrícula</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Matrícula -->
    <div class="modal fade" id="modalEditarMatricula" tabindex="-1" role="dialog" aria-labelledby="modalEditarMatriculaLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalEditarMatriculaLabel">Editar Matrícula</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formEditarMatricula" method="POST" action="atualizar_matricula.php">
                        <input type="hidden" id="editar_id_matricula" name="id_matricula">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Aluno</label>
                                    <input type="text" class="form-control" id="editar_nome_aluno" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Número de Matrícula</label>
                                    <input type="text" class="form-control" id="editar_numero_matricula" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="editar_curso">Curso *</label>
                                    <select class="form-control" id="editar_curso" name="id_curso" required>
                                        <option value="">Selecione um curso</option>
                                        <?php foreach ($cursos as $curso): ?>
                                        <option value="<?= $curso['id_curso'] ?>"><?= htmlspecialchars($curso['nome']) ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="editar_turma">Turma *</label>
                                    <select class="form-control" id="editar_turma" name="id_turma" required>
                                        <option value="">Selecione um curso primeiro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="editar_classe">Classe *</label>
                                    <select class="form-control" id="editar_classe" name="classe" required>
                                        <option value="10ª">10ª Classe</option>
                                        <option value="11ª">11ª Classe</option>
                                        <option value="12ª">12ª Classe</option>
                                        <option value="13ª">13ª Classe</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editar_turno">Turno *</label>
                                    <select class="form-control" id="editar_turno" name="turno" required>
                                        <option value="Manhã">Manhã</option>
                                        <option value="Tarde">Tarde</option>
                                        <option value="Noite">Noite</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="editar_status">Status *</label>
                                    <select class="form-control" id="editar_status" name="status" required>
                                        <option value="ativa">Ativa</option>
                                        <option value="trancada">Trancada</option>
                                        <option value="cancelada">Cancelada</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-info">Atualizar Matrícula</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Warning Section Ends -->
    <!-- Required Jquery -->
    <script data-cfasync="false" src="..\..\..\cdn-cgi\scripts\5c5dd728\cloudflare-static\email-decode.min.js"></script><script type="text/javascript" src="libraries\bower_components\jquery\js\jquery.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\jquery-ui\js\jquery-ui.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\popper.js\js\popper.min.js"></script>
    <script type="text/javascript" src="libraries\bower_components\bootstrap\js\bootstrap.min.js"></script>
    <!-- jquery slimscroll js -->
    <script type="text/javascript" src="libraries\bower_components\jquery-slimscroll\js\jquery.slimscroll.js"></script>
    <!-- modernizr js -->
    <script type="text/javascript" src="libraries\bower_components\modernizr\js\modernizr.js"></script>
    <!-- Chart js -->
    <script type="text/javascript" src="libraries\bower_components\chart.js\js\Chart.js"></script>
    <!-- amchart js -->
    <script src="libraries\assets\pages\widget\amchart\amcharts.js"></script>
    <script src="libraries\assets\pages\widget\amchart\serial.js"></script>
    <script src="libraries\assets\pages\widget\amchart\light.js"></script>
    <script src="libraries\assets\js\jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="libraries\assets\js\SmoothScroll.js"></script>
    <script src="libraries\assets\js\pcoded.min.js"></script>
    <!-- custom js -->
    <script src="libraries\assets\js\vartical-layout.min.js"></script>
    <script type="text/javascript" src="libraries\assets\js\script.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>

    <script>
        // Carregar turmas quando um curso é selecionado
        function carregarTurmas(id_curso, elemento) {
            if(id_curso) {
                $.ajax({
                    url: 'getTurma.php',
                    method: 'GET',
                    data: { id_curso: id_curso },
                    success: function(response) {
                        $(elemento).html(response);
                    },
                    error: function() {
                        $(elemento).html('<option value="">Erro ao carregar turmas</option>');
                    }
                });
            } else {
                $(elemento).html('<option value="">Selecione um curso primeiro</option>');
            }
        }
        
        // Editar matrícula url: 'ajax/get_matricula.php',
        function editarMatricula(id) {
            $.ajax({
                url: 'get_matricula.php',
                method: 'GET',
                data: { id: id },
                dataType: 'json',
                success: function(matricula) {
                    $('#editar_id_matricula').val(matricula.id_matricula);
                    $('#editar_nome_aluno').val(matricula.nome);
                    $('#editar_numero_matricula').val(matricula.numero_matricula);
                    $('#editar_curso').val(matricula.curso_id_curso);
                    
                    // Carregar turmas do curso selecionado
                    carregarTurmas(matricula.curso_id_curso, '#editar_turma');
                    
                    // Aguardar um pouco para garantir que as turmas foram carregadas
                    setTimeout(function() {
                        $('#editar_turma').val(matricula.turma_id_turma);
                    }, 300);
                    
                    $('#editar_classe').val(matricula.classe);
                    $('#editar_turno').val(matricula.turno);
                    $('#editar_status').val(matricula.status_matricula);
                    
                    $('#modalEditarMatricula').modal('show');
                },
                error: function() {
                    alert('Erro ao carregar dados da matrícula');
                }
            });
        }
        
        // Cancelar matrícula
        function cancelarMatricula(id) {
            if(confirm('Deseja realmente cancelar esta matrícula?')) {
                $.ajax({
                    url: 'cancelar_matricula.php',
                    method: 'POST',
                    data: { id: id },
                    dataType: 'json',
                    success: function(response) {
                        if(response.success) {
                            alert('Matrícula cancelada com sucesso');
                            location.reload();
                        } else {
                            alert('Erro: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('Erro na comunicação com o servidor');
                    }
                });
            }
        }
        
        // Emitir comprovante
        function emitirComprovante(id) {
            window.open('comprovante_matricula.php?id=' + id, '_blank');
        }
        
        // Carregar turmas quando um curso é selecionado
        $(document).ready(function() {
            $('#curso_matricula').change(function() {
                carregarTurmas($(this).val(), '#turma_matricula');
            });
            
            $('#editar_curso').change(function() {
                carregarTurmas($(this).val(), '#editar_turma');
            });
        });
    </script>
</body>
</html>